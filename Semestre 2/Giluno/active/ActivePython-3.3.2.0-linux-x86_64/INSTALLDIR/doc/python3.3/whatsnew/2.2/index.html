<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>What's New in Python 2.2</title>
<META NAME="description" CONTENT="What's New in Python 2.2">
<META NAME="keywords" CONTENT="python-22">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<meta http-equiv="Content-Type" content="text/html; charset=">
<link rel="first" href="index.html">
<link rel="contents" href="contents.html" title="Contents">

<link rel="stylesheet" href="../style.css" type="text/css">
</head>
<body>

<div class="titlepage">
<center>
<table width="100%" border="0" cellspacing="0" cellpadding="1">
<tr class="header">
<td>
<table class="navigation" width="100%" border="0" cellspacing="0" cellpadding="3">
<tr>
<td align="center">What's New in Python 2.2</td>
</tr>
</table>
</td>
</tr>
</table>
<p><span class="authorname">A.M. Kuchling</span></p>
<p><span class="authoremail">akuchlin@mems-exchange.org</span></p>
</center>
</div>
<BR><H2><A NAME="SECTION000100000000000000000">
Contents</A>
</H2>
<!--Table of Contents-->

<UL>
<LI><A href="index.html">Contents</a>
<LI><A href="index.html#SECTION000200000000000000000">1 Introduction</a>
<LI><A href="index.html#SECTION000300000000000000000">2 PEPs 252 and 253: Type and Class Changes</a>
<UL>
<LI><A href="index.html#SECTION000310000000000000000">2.1 Old and New Classes</a>
<LI><A href="index.html#SECTION000320000000000000000">2.2 Descriptors</a>
<LI><A href="index.html#SECTION000330000000000000000">2.3 Multiple Inheritance: The Diamond Rule</a>
<LI><A href="index.html#SECTION000340000000000000000">2.4 Attribute Access</a>
<LI><A href="index.html#SECTION000350000000000000000">2.5 Related Links</a>
</ul>
<LI><A href="index.html#SECTION000400000000000000000">3 PEP 234: Iterators</a>
<LI><A href="index.html#SECTION000500000000000000000">4 PEP 255: Simple Generators</a>
<LI><A href="index.html#SECTION000600000000000000000">5 PEP 237: Unifying Long Integers and Integers</a>
<LI><A href="index.html#SECTION000700000000000000000">6 PEP 238: Changing the Division Operator</a>
<LI><A href="index.html#SECTION000800000000000000000">7 Unicode Changes</a>
<LI><A href="index.html#SECTION000900000000000000000">8 PEP 227: Nested Scopes</a>
<LI><A href="index.html#SECTION0001000000000000000000">9 New and Improved Modules</a>
<LI><A href="index.html#SECTION0001100000000000000000">10 Interpreter Changes and Fixes</a>
<LI><A href="index.html#SECTION0001200000000000000000">11 Other Changes and Fixes</a>
<LI><A href="index.html#SECTION0001300000000000000000">12 Acknowledgements</a>
<LI><A href="index.html#SECTION0001400000000000000000">About this document ...</a>
</ul>
<!--End of Table of Contents-->
<P>

<H1><A NAME="SECTION000200000000000000000">
1 Introduction</A>
</H1>

<P>
This article explains the new features in Python 2.2, released on
December 21, 2001.

<P>
Python 2.2 can be thought of as the "cleanup release".  There are some
features such as generators and iterators that are completely new, but
most of the changes, significant and far-reaching though they may be,
are aimed at cleaning up irregularities and dark corners of the
language design.

<P>
This article doesn't attempt to provide a complete specification of
the new features, but instead provides a convenient overview.  For
full details, you should refer to the documentation for Python 2.2,
such as the
<em class="citetitle"><a
 href="http://www.python.org/doc/2.2/lib/lib.html"
 title="Python
Library Reference"
 >Python
Library Reference</a></em> and the
<em class="citetitle"><a
 href="http://www.python.org/doc/2.2/ref/ref.html"
 title="Python
Reference Manual"
 >Python
Reference Manual</a></em>.  If you want to understand the complete
implementation and design rationale for a change, refer to the PEP for
a particular new feature.

<P>
<div class="seealso">
  <p class="heading"><b>See Also:</b></p>

<P>
<dl compact class="seeurl">
    <dt><a href="http://www.unixreview.com/documents/s=1356/urm0109h/0109h.htm"
        class="url">http://www.unixreview.com/documents/s=1356/urm0109h/0109h.htm</a>
    <dd>``What's So Special About Python 2.2?'' is also about the new 2.2
features, and was written by Cameron Laird and Kathryn Soraiz.
  </dl>

<P>
</div>

<P>

<H1><A NAME="SECTION000300000000000000000">
2 PEPs 252 and 253: Type and Class Changes</A>
</H1>

<P>
The largest and most far-reaching changes in Python 2.2 are to
Python's model of objects and classes.  The changes should be backward
compatible, so it's likely that your code will continue to run
unchanged, but the changes provide some amazing new capabilities.
Before beginning this, the longest and most complicated section of
this article, I'll provide an overview of the changes and offer some
comments.

<P>
A long time ago I wrote a Web page
(<a class="url" href="http://www.amk.ca/python/writing/warts.html">http://www.amk.ca/python/writing/warts.html</a>) listing flaws in
Python's design.  One of the most significant flaws was that it's
impossible to subclass Python types implemented in C.  In particular,
it's not possible to subclass built-in types, so you can't just
subclass, say, lists in order to add a single useful method to them.
The <tt class="module">UserList</tt> module provides a class that supports all of the
methods of lists and that can be subclassed further, but there's lots
of C code that expects a regular Python list and won't accept a
<tt class="class">UserList</tt> instance.

<P>
Python 2.2 fixes this, and in the process adds some exciting new
capabilities.  A brief summary:

<P>

<UL>
<LI>You can subclass built-in types such as lists and even integers,
and your subclasses should work in every place that requires the
original type.

<P>
</LI>
<LI>It's now possible to define static and class methods, in addition
to the instance methods available in previous versions of Python.

<P>
</LI>
<LI>It's also possible to automatically call methods on accessing or
setting an instance attribute by using a new mechanism called
<i class="dfn">properties</i>.  Many uses of <tt class="method">__getattr__</tt> can be rewritten
to use properties instead, making the resulting code simpler and
faster.  As a small side benefit, attributes can now have docstrings,
too.

<P>
</LI>
<LI>The list of legal attributes for an instance can be limited to a
particular set using <i class="dfn">slots</i>, making it possible to safeguard
against typos and perhaps make more optimizations possible in future
versions of Python.

<P>
</LI>
</UL>

<P>
Some users have voiced concern about all these changes.  Sure, they
say, the new features are neat and lend themselves to all sorts of
tricks that weren't possible in previous versions of Python, but
they also make the language more complicated.  Some people have said
that they've always recommended Python for its simplicity, and feel
that its simplicity is being lost.

<P>
Personally, I think there's no need to worry.  Many of the new
features are quite esoteric, and you can write a lot of Python code
without ever needed to be aware of them.  Writing a simple class is no
more difficult than it ever was, so you don't need to bother learning
or teaching them unless they're actually needed.  Some very
complicated tasks that were previously only possible from C will now
be possible in pure Python, and to my mind that's all for the better.

<P>
I'm not going to attempt to cover every single corner case and small
change that were required to make the new features work.  Instead this
section will paint only the broad strokes.  See section&nbsp;<A HREF="index.html#sect-rellinks">2.5</A>,
``Related Links'', for further sources of information about Python 2.2's new
object model.

<P>

<H2><A NAME="SECTION000310000000000000000">
2.1 Old and New Classes</A>
</H2>

<P>
First, you should know that Python 2.2 really has two kinds of
classes: classic or old-style classes, and new-style classes.  The
old-style class model is exactly the same as the class model in
earlier versions of Python.  All the new features described in this
section apply only to new-style classes. This divergence isn't
intended to last forever; eventually old-style classes will be
dropped, possibly in Python 3.0.

<P>
So how do you define a new-style class?  You do it by subclassing an
existing new-style class.  Most of Python's built-in types, such as
integers, lists, dictionaries, and even files, are new-style classes
now.  A new-style class named <tt class="class">object</tt>, the base class for all
built-in types, has been also been added so if no built-in type is
suitable, you can just subclass <tt class="class">object</tt>:

<P>
<dl><dd><pre class="verbatim">
class C(object):
    def __init__ (self):
        ...
    ...
</pre></dl>

<P>
This means that <tt class="keyword">class</tt> statements that don't have any base
classes are always classic classes in Python 2.2.  (Actually you can
also change this by setting a module-level variable named
<tt class="member">__metaclass__</tt> -- see <a class="rfc" name="rfcref-1145"
href="http://python.sourceforge.net/peps/pep-0253.html">PEP 253</a> for the details -- but it's
easier to just subclass <tt class="keyword">object</tt>.)

<P>
The type objects for the built-in types are available as built-ins,
named using a clever trick.  Python has always had built-in functions
named <tt class="function">int()</tt>, <tt class="function">float()</tt>, and <tt class="function">str()</tt>.  In
2.2, they aren't functions any more, but type objects that behave as
factories when called.

<P>
<dl><dd><pre class="verbatim">
&gt;&gt;&gt; int
&lt;type 'int'&gt;
&gt;&gt;&gt; int('123')
123
</pre></dl>

<P>
To make the set of types complete, new type objects such as
<tt class="function">dict</tt> and <tt class="function">file</tt> have been added.  Here's a
more interesting example, adding a <tt class="method">lock()</tt> method to file
objects:

<P>
<dl><dd><pre class="verbatim">
class LockableFile(file):
    def lock (self, operation, length=0, start=0, whence=0):
        import fcntl
        return fcntl.lockf(self.fileno(), operation,
                           length, start, whence)
</pre></dl>

<P>
The now-obsolete <tt class="module">posixfile</tt> module contained a class that
emulated all of a file object's methods and also added a
<tt class="method">lock()</tt> method, but this class couldn't be passed to internal
functions that expected a built-in file, something which is possible
with our new <tt class="class">LockableFile</tt>.

<P>

<H2><A NAME="SECTION000320000000000000000">
2.2 Descriptors</A>
</H2>

<P>
In previous versions of Python, there was no consistent way to
discover what attributes and methods were supported by an object.
There were some informal conventions, such as defining
<tt class="member">__members__</tt> and <tt class="member">__methods__</tt> attributes that were
lists of names, but often the author of an extension type or a class
wouldn't bother to define them.  You could fall back on inspecting the
<tt class="member">__dict__</tt> of an object, but when class inheritance or an
arbitrary <tt class="method">__getattr__</tt> hook were in use this could still be
inaccurate.

<P>
The one big idea underlying the new class model is that an API for
describing the attributes of an object using <i class="dfn">descriptors</i> has
been formalized.  Descriptors specify the value of an attribute,
stating whether it's a method or a field.  With the descriptor API,
static methods and class methods become possible, as well as more
exotic constructs.

<P>
Attribute descriptors are objects that live inside class objects, and
have a few attributes of their own:

<P>

<UL>
<LI><tt class="member">__name__</tt> is the attribute's name.

<P>
</LI>
<LI><tt class="member">__doc__</tt> is the attribute's docstring.

<P>
</LI>
<LI><tt class="method">__get__(<var>object</var>)</tt> is a method that retrieves the
attribute value from <var>object</var>. 

<P>
</LI>
<LI><tt class="method">__set__(<var>object</var>, <var>value</var>)</tt> sets the attribute
on <var>object</var> to <var>value</var>.

<P>
</LI>
<LI><tt class="method">__delete__(<var>object</var>, <var>value</var>)</tt> deletes the <var>value</var> 
attribute of <var>object</var>.
</LI>
</UL>

<P>
For example, when you write <code>obj.x</code>, the steps that Python
actually performs are:

<P>
<dl><dd><pre class="verbatim">
descriptor = obj.__class__.x
descriptor.__get__(obj)
</pre></dl>

<P>
For methods, <tt class="method">descriptor.__get__</tt> returns a temporary object that's
callable, and wraps up the instance and the method to be called on it.
This is also why static methods and class methods are now possible;
they have descriptors that wrap up just the method, or the method and
the class.  As a brief explanation of these new kinds of methods,
static methods aren't passed the instance, and therefore resemble
regular functions.  Class methods are passed the class of the object,
but not the object itself.  Static and class methods are defined like
this:

<P>
<dl><dd><pre class="verbatim">
class C(object):
    def f(arg1, arg2):
        ...
    f = staticmethod(f)

    def g(cls, arg1, arg2):
        ...
    g = classmethod(g)
</pre></dl>

<P>
The <tt class="function">staticmethod()</tt> function takes the function
<tt class="function">f</tt>, and returns it wrapped up in a descriptor so it can be
stored in the class object.  You might expect there to be special
syntax for creating such methods (<code>def static f()</code>,
<code>defstatic f()</code>, or something like that) but no such syntax has
been defined yet; that's been left for future versions of Python.

<P>
More new features, such as slots and properties, are also implemented
as new kinds of descriptors, and it's not difficult to write a
descriptor class that does something novel.  For example, it would be
possible to write a descriptor class that made it possible to write
Eiffel-style preconditions and postconditions for a method.  A class
that used this feature might be defined like this:

<P>
<dl><dd><pre class="verbatim">
from eiffel import eiffelmethod

class C(object):
    def f(self, arg1, arg2):
        # The actual function
        ...
    def pre_f(self):
        # Check preconditions
        ...
    def post_f(self):
        # Check postconditions
        ...

    f = eiffelmethod(f, pre_f, post_f)
</pre></dl>

<P>
Note that a person using the new <tt class="function">eiffelmethod()</tt> doesn't
have to understand anything about descriptors.  This is why I think
the new features don't increase the basic complexity of the language.
There will be a few wizards who need to know about it in order to
write <tt class="function">eiffelmethod()</tt> or the ZODB or whatever, but most
users will just write code on top of the resulting libraries and
ignore the implementation details.

<P>

<H2><A NAME="SECTION000330000000000000000">
2.3 Multiple Inheritance: The Diamond Rule</A>
</H2>

<P>
Multiple inheritance has also been made more useful through changing
the rules under which names are resolved.  Consider this set of classes
(diagram taken from <a class="rfc" name="rfcref-1149"
href="http://python.sourceforge.net/peps/pep-0253.html">PEP 253</a> by Guido van Rossum):

<P>
<dl><dd><pre class="verbatim">
                class A:
                  ^ ^  def save(self): ...
                 /   \
                /     \
               /       \
              /         \
          class B     class C:
              ^         ^  def save(self): ...
               \       /
                \     /
                 \   /
                  \ /
                class D
</pre></dl>

<P>
The lookup rule for classic classes is simple but not very smart; the
base classes are searched depth-first, going from left to right.  A
reference to <tt class="method">D.save</tt> will search the classes <tt class="class">D</tt>,
<tt class="class">B</tt>, and then <tt class="class">A</tt>, where <tt class="method">save()</tt> would be found
and returned.  <tt class="method">C.save()</tt> would never be found at all.  This is
bad, because if <tt class="class">C</tt>'s <tt class="method">save()</tt> method is saving some
internal state specific to <tt class="class">C</tt>, not calling it will result in
that state never getting saved.

<P>
New-style classes follow a different algorithm that's a bit more
complicated to explain, but does the right thing in this situation.

<P>

<OL>
<LI>List all the base classes, following the classic lookup rule and
include a class multiple times if it's visited repeatedly.  In the
above example, the list of visited classes is [<tt class="class">D</tt>, <tt class="class">B</tt>,
<tt class="class">A</tt>, <tt class="class">C</tt>, <tt class="class">A</tt>].

<P>
</LI>
<LI>Scan the list for duplicated classes.  If any are found, remove
all but one occurrence, leaving the <i>last</i> one in the list.  In
the above example, the list becomes [<tt class="class">D</tt>, <tt class="class">B</tt>, <tt class="class">C</tt>,
<tt class="class">A</tt>] after dropping duplicates.

<P>
</LI>
</OL>

<P>
Following this rule, referring to <tt class="method">D.save()</tt> will return
<tt class="method">C.save()</tt>, which is the behaviour we're after.  This lookup
rule is the same as the one followed by Common Lisp.  A new built-in
function, <tt class="function">super()</tt>, provides a way to get at a class's
superclasses without having to reimplement Python's algorithm.
The most commonly used form will be 
<tt class="function">super(<var>class</var>, <var>obj</var>)</tt>, which returns 
a bound superclass object (not the actual class object).  This form
will be used in methods to call a method in the superclass; for
example, <tt class="class">D</tt>'s <tt class="method">save()</tt> method would look like this:

<P>
<dl><dd><pre class="verbatim">
class D:
    def save (self):
	# Call superclass .save()
        super(D, self).save()
        # Save D's private information here
        ...
</pre></dl>

<P>
<tt class="function">super()</tt> can also return unbound superclass objects
when called as <tt class="function">super(<var>class</var>)</tt> or
<tt class="function">super(<var>class1</var>, <var>class2</var>)</tt>, but this probably won't
often be useful.

<P>

<H2><A NAME="SECTION000340000000000000000">
2.4 Attribute Access</A>
</H2>

<P>
A fair number of sophisticated Python classes define hooks for
attribute access using <tt class="method">__getattr__</tt>; most commonly this is
done for convenience, to make code more readable by automatically
mapping an attribute access such as <code>obj.parent</code> into a method
call such as <code>obj.get_parent()</code>.  Python 2.2 adds some new ways
of controlling attribute access.

<P>
First, <tt class="method">__getattr__(<var>attr_name</var>)</tt> is still supported by
new-style classes, and nothing about it has changed.  As before, it
will be called when an attempt is made to access <code>obj.foo</code> and no
attribute named "<tt class="samp">foo</tt>" is found in the instance's dictionary.

<P>
New-style classes also support a new method,
<tt class="method">__getattribute__(<var>attr_name</var>)</tt>.  The difference between
the two methods is that <tt class="method">__getattribute__</tt> is <i>always</i>
called whenever any attribute is accessed, while the old
<tt class="method">__getattr__</tt> is only called if "<tt class="samp">foo</tt>" isn't found in the
instance's dictionary.

<P>
However, Python 2.2's support for <i class="dfn">properties</i> will often be a
simpler way to trap attribute references.  Writing a
<tt class="method">__getattr__</tt> method is complicated because to avoid recursion
you can't use regular attribute accesses inside them, and instead have
to mess around with the contents of <tt class="member">__dict__</tt>.
<tt class="method">__getattr__</tt> methods also end up being called by Python when
it checks for other methods such as <tt class="method">__repr__</tt> or
<tt class="method">__coerce__</tt>, and so have to be written with this in mind.
Finally, calling a function on every attribute access results in a
sizable performance loss.

<P>
<tt class="class">property</tt> is a new built-in type that packages up three
functions that get, set, or delete an attribute, and a docstring.  For
example, if you want to define a <tt class="member">size</tt> attribute that's
computed, but also settable, you could write:

<P>
<dl><dd><pre class="verbatim">
class C(object):
    def get_size (self):
        result = ... computation ...
        return result
    def set_size (self, size):
        ... compute something based on the size
        and set internal state appropriately ...

    # Define a property.  The 'delete this attribute'
    # method is defined as None, so the attribute
    # can't be deleted.
    size = property(get_size, set_size,
                    None,
                    "Storage size of this instance")
</pre></dl>

<P>
That is certainly clearer and easier to write than a pair of
<tt class="method">__getattr__</tt>/<tt class="method">__setattr__</tt> methods that check for the
<tt class="member">size</tt> attribute and handle it specially while retrieving all
other attributes from the instance's <tt class="member">__dict__</tt>.  Accesses to
<tt class="member">size</tt> are also the only ones which have to perform the work of
calling a function, so references to other attributes run at
their usual speed.

<P>
Finally, it's possible to constrain the list of attributes that can be
referenced on an object using the new <tt class="member">__slots__</tt> class attribute.
Python objects are usually very dynamic; at any time it's possible to
define a new attribute on an instance by just doing
<code>obj.new_attr=1</code>.  This is flexible and convenient, but this
flexibility can also lead to bugs, as when you meant to write
<code>obj.template = 'a'</code> but made a typo and wrote
<code>obj.templtae</code> by accident.  

<P>
A new-style class can define a class attribute named <tt class="member">__slots__</tt>
to constrain the list of legal attribute names.  An example will make
this clear:

<P>
<dl><dd><pre class="verbatim">
&gt;&gt;&gt; class C(object):
...     __slots__ = ('template', 'name')
...
&gt;&gt;&gt; obj = C()
&gt;&gt;&gt; print obj.template
None
&gt;&gt;&gt; obj.template = 'Test'
&gt;&gt;&gt; print obj.template
Test
&gt;&gt;&gt; obj.templtae = None
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
AttributeError: 'C' object has no attribute 'templtae'
</pre></dl>

<P>
Note how you get an <tt class="exception">AttributeError</tt> on the attempt to
assign to an attribute not listed in <tt class="member">__slots__</tt>.

<P>

<H2><A NAME="SECTION000350000000000000000">&nbsp;</A>
<BR>
2.5 Related Links
</H2>

<P>
This section has just been a quick overview of the new features,
giving enough of an explanation to start you programming, but many
details have been simplified or ignored.  Where should you go to get a
more complete picture?

<P>
<a class="url" href="http://www.python.org/2.2/descrintro.html">http://www.python.org/2.2/descrintro.html</a> is a lengthy tutorial
introduction to the descriptor features, written by Guido van Rossum.
If my description has whetted your appetite, go read this tutorial
next, because it goes into much more detail about the new features
while still remaining quite easy to read.

<P>
Next, there are two relevant PEPs, <a class="rfc" name="rfcref-1153"
href="http://python.sourceforge.net/peps/pep-0252.html">PEP 252</a> and <a class="rfc" name="rfcref-1155"
href="http://python.sourceforge.net/peps/pep-0253.html">PEP 253</a>.  <a class="rfc" name="rfcref-1157"
href="http://python.sourceforge.net/peps/pep-0252.html">PEP 252</a>
is titled "Making Types Look More Like Classes", and covers the
descriptor API.  <a class="rfc" name="rfcref-1159"
href="http://python.sourceforge.net/peps/pep-0253.html">PEP 253</a> is titled "Subtyping Built-in Types", and
describes the changes to type objects that make it possible to subtype
built-in objects.  <a class="rfc" name="rfcref-1161"
href="http://python.sourceforge.net/peps/pep-0253.html">PEP 253</a> is the more complicated PEP of the two,
and at a few points the necessary explanations of types and meta-types
may cause your head to explode.  Both PEPs were written and
implemented by Guido van Rossum, with substantial assistance from the
rest of the Zope Corp. team.

<P>
Finally, there's the ultimate authority: the source code.  Most of the
machinery for the type handling is in <span class="file">Objects/typeobject.c</span>, but
you should only resort to it after all other avenues have been
exhausted, including posting a question to python-list or python-dev. 

<P>

<H1><A NAME="SECTION000400000000000000000">
3 PEP 234: Iterators</A>
</H1>

<P>
Another significant addition to 2.2 is an iteration interface at both
the C and Python levels.  Objects can define how they can be looped
over by callers.

<P>
In Python versions up to 2.1, the usual way to make <code>for item in
obj</code> work is to define a <tt class="method">__getitem__()</tt> method that looks
something like this:

<P>
<dl><dd><pre class="verbatim">
    def __getitem__(self, index):
        return &lt;next item&gt;
</pre></dl>

<P>
<tt class="method">__getitem__()</tt> is more properly used to define an indexing
operation on an object so that you can write <code>obj[5]</code> to retrieve
the sixth element.  It's a bit misleading when you're using this only
to support <tt class="keyword">for</tt> loops.  Consider some file-like object that
wants to be looped over; the <var>index</var> parameter is essentially
meaningless, as the class probably assumes that a series of
<tt class="method">__getitem__()</tt> calls will be made with <var>index</var>
incrementing by one each time.  In other words, the presence of the
<tt class="method">__getitem__()</tt> method doesn't mean that using <code>file[5]</code> 
to randomly access the sixth element will work, though it really should.

<P>
In Python 2.2, iteration can be implemented separately, and
<tt class="method">__getitem__()</tt> methods can be limited to classes that really
do support random access.  The basic idea of iterators is 
simple.  A new built-in function, <tt class="function">iter(obj)</tt> or
<code>iter(<var>C</var>, <var>sentinel</var>)</code>, is used to get an iterator.
<tt class="function">iter(obj)</tt> returns an iterator for the object <var>obj</var>,
while <code>iter(<var>C</var>, <var>sentinel</var>)</code> returns an iterator that
will invoke the callable object <var>C</var> until it returns
<var>sentinel</var> to signal that the iterator is done.  

<P>
Python classes can define an <tt class="method">__iter__()</tt> method, which should
create and return a new iterator for the object; if the object is its
own iterator, this method can just return <code>self</code>.  In particular,
iterators will usually be their own iterators.  Extension types
implemented in C can implement a <code>tp_iter</code> function in order to
return an iterator, and extension types that want to behave as
iterators can define a <code>tp_iternext</code> function.

<P>
So, after all this, what do iterators actually do?  They have one
required method, <tt class="method">next()</tt>, which takes no arguments and returns
the next value.  When there are no more values to be returned, calling
<tt class="method">next()</tt> should raise the <tt class="exception">StopIteration</tt> exception.

<P>
<dl><dd><pre class="verbatim">
&gt;&gt;&gt; L = [1,2,3]
&gt;&gt;&gt; i = iter(L)
&gt;&gt;&gt; print i
&lt;iterator object at 0x8116870&gt;
&gt;&gt;&gt; i.next()
1
&gt;&gt;&gt; i.next()
2
&gt;&gt;&gt; i.next()
3
&gt;&gt;&gt; i.next()
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
StopIteration
&gt;&gt;&gt;
</pre></dl>

<P>
In 2.2, Python's <tt class="keyword">for</tt> statement no longer expects a sequence;
it expects something for which <tt class="function">iter()</tt> will return an iterator.
For backward compatibility and convenience, an iterator is
automatically constructed for sequences that don't implement
<tt class="method">__iter__()</tt> or a <code>tp_iter</code> slot, so <code>for i in
[1,2,3]</code> will still work.  Wherever the Python interpreter loops over
a sequence, it's been changed to use the iterator protocol.  This
means you can do things like this:

<P>
<dl><dd><pre class="verbatim">
&gt;&gt;&gt; L = [1,2,3]
&gt;&gt;&gt; i = iter(L)
&gt;&gt;&gt; a,b,c = i
&gt;&gt;&gt; a,b,c
(1, 2, 3)
</pre></dl>

<P>
Iterator support has been added to some of Python's basic types.  
Calling <tt class="function">iter()</tt> on a dictionary will return an iterator
which loops over its keys:

<P>
<dl><dd><pre class="verbatim">
&gt;&gt;&gt; m = {'Jan': 1, 'Feb': 2, 'Mar': 3, 'Apr': 4, 'May': 5, 'Jun': 6,
...      'Jul': 7, 'Aug': 8, 'Sep': 9, 'Oct': 10, 'Nov': 11, 'Dec': 12}
&gt;&gt;&gt; for key in m: print key, m[key]
...
Mar 3
Feb 2
Aug 8
Sep 9
May 5
Jun 6
Jul 7
Jan 1
Apr 4
Nov 11
Dec 12
Oct 10
</pre></dl>          

<P>
That's just the default behaviour.  If you want to iterate over keys,
values, or key/value pairs, you can explicitly call the
<tt class="method">iterkeys()</tt>, <tt class="method">itervalues()</tt>, or <tt class="method">iteritems()</tt>
methods to get an appropriate iterator.  In a minor related change,
the <tt class="keyword">in</tt> operator now works on dictionaries, so
<code><var>key</var> in dict</code> is now equivalent to
<code>dict.has_key(<var>key</var>)</code>.

<P>
Files also provide an iterator, which calls the <tt class="method">readline()</tt>
method until there are no more lines in the file.  This means you can
now read each line of a file using code like this:

<P>
<dl><dd><pre class="verbatim">
for line in file:
    # do something for each line
    ...
</pre></dl>

<P>
Note that you can only go forward in an iterator; there's no way to
get the previous element, reset the iterator, or make a copy of it.
An iterator object could provide such additional capabilities, but the
iterator protocol only requires a <tt class="method">next()</tt> method.

<P>
<div class="seealso">
  <p class="heading"><b>See Also:</b></p>

<P>
<dl compact class="seerfc">
    <dt><a href="http://python.sourceforge.net/peps/pep-0234.html"
        title="Iterators"
        >PEP 234, <em>Iterators</em></a>
    <dd>Written by Ka-Ping Yee and GvR; implemented 
by the Python Labs crew, mostly by GvR and Tim Peters.
  </dl>

<P>
</div>

<P>

<H1><A NAME="SECTION000500000000000000000">
4 PEP 255: Simple Generators</A>
</H1>

<P>
Generators are another new feature, one that interacts with the
introduction of iterators.

<P>
You're doubtless familiar with how function calls work in Python or
C.  When you call a function, it gets a private namespace where its local
variables are created.  When the function reaches a <tt class="keyword">return</tt>
statement, the local variables are destroyed and the resulting value
is returned to the caller.  A later call to the same function will get
a fresh new set of local variables.  But, what if the local variables
weren't thrown away on exiting a function?  What if you could later
resume the function where it left off?  This is what generators
provide; they can be thought of as resumable functions.

<P>
Here's the simplest example of a generator function:

<P>
<dl><dd><pre class="verbatim">
def generate_ints(N):
    for i in range(N):
        yield i
</pre></dl>

<P>
A new keyword, <tt class="keyword">yield</tt>, was introduced for generators.  Any
function containing a <tt class="keyword">yield</tt> statement is a generator
function; this is detected by Python's bytecode compiler which
compiles the function specially as a result.  Because a new keyword was
introduced, generators must be explicitly enabled in a module by
including a <code>from __future__ import generators</code> statement near
the top of the module's source code.  In Python 2.3 this statement
will become unnecessary.

<P>
When you call a generator function, it doesn't return a single value;
instead it returns a generator object that supports the iterator
protocol.  On executing the <tt class="keyword">yield</tt> statement, the generator
outputs the value of <code>i</code>, similar to a <tt class="keyword">return</tt>
statement.  The big difference between <tt class="keyword">yield</tt> and a
<tt class="keyword">return</tt> statement is that on reaching a <tt class="keyword">yield</tt> the
generator's state of execution is suspended and local variables are
preserved.  On the next call to the generator's <code>.next()</code> method,
the function will resume executing immediately after the
<tt class="keyword">yield</tt> statement.  (For complicated reasons, the
<tt class="keyword">yield</tt> statement isn't allowed inside the <tt class="keyword">try</tt> block
of a <code>try...finally</code> statement; read <a class="rfc" name="rfcref-1168"
href="http://python.sourceforge.net/peps/pep-0255.html">PEP 255</a> for a full
explanation of the interaction between <tt class="keyword">yield</tt> and
exceptions.)

<P>
Here's a sample usage of the <tt class="function">generate_ints</tt> generator:

<P>
<dl><dd><pre class="verbatim">
&gt;&gt;&gt; gen = generate_ints(3)
&gt;&gt;&gt; gen
&lt;generator object at 0x8117f90&gt;
&gt;&gt;&gt; gen.next()
0
&gt;&gt;&gt; gen.next()
1
&gt;&gt;&gt; gen.next()
2
&gt;&gt;&gt; gen.next()
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
  File "&lt;stdin&gt;", line 2, in generate_ints
StopIteration
</pre></dl>

<P>
You could equally write <code>for i in generate_ints(5)</code>, or
<code>a,b,c = generate_ints(3)</code>.

<P>
Inside a generator function, the <tt class="keyword">return</tt> statement can only
be used without a value, and signals the end of the procession of
values; afterwards the generator cannot return any further values.
<tt class="keyword">return</tt> with a value, such as <code>return 5</code>, is a syntax
error inside a generator function.  The end of the generator's results
can also be indicated by raising <tt class="exception">StopIteration</tt> manually,
or by just letting the flow of execution fall off the bottom of the
function.

<P>
You could achieve the effect of generators manually by writing your
own class and storing all the local variables of the generator as
instance variables.  For example, returning a list of integers could
be done by setting <code>self.count</code> to 0, and having the
<tt class="method">next()</tt> method increment <code>self.count</code> and return it.
However, for a moderately complicated generator, writing a
corresponding class would be much messier.
<span class="file">Lib/test/test_generators.py</span> contains a number of more
interesting examples.  The simplest one implements an in-order
traversal of a tree using generators recursively.

<P>
<dl><dd><pre class="verbatim">
# A recursive generator that generates Tree leaves in in-order.
def inorder(t):
    if t:
        for x in inorder(t.left):
            yield x
        yield t.label
        for x in inorder(t.right):
            yield x
</pre></dl>

<P>
Two other examples in <span class="file">Lib/test/test_generators.py</span> produce
solutions for the N-Queens problem (placing <SPAN CLASS="MATH"></SPAN> queens on an <SPAN CLASS="MATH"></SPAN>
chess board so that no queen threatens another) and the Knight's Tour
(a route that takes a knight to every square of an <SPAN CLASS="MATH"></SPAN> chessboard
without visiting any square twice). 

<P>
The idea of generators comes from other programming languages,
especially Icon (<a class="url" href="http://www.cs.arizona.edu/icon/">http://www.cs.arizona.edu/icon/</a>), where the
idea of generators is central.  In Icon, every
expression and function call behaves like a generator.  One example
from ``An Overview of the Icon Programming Language'' at
<a class="url" href="http://www.cs.arizona.edu/icon/docs/ipd266.htm">http://www.cs.arizona.edu/icon/docs/ipd266.htm</a> gives an idea of
what this looks like:

<P>
<dl><dd><pre class="verbatim">
sentence := "Store it in the neighboring harbor"
if (i := find("or", sentence)) &gt; 5 then write(i)
</pre></dl>

<P>
In Icon the <tt class="function">find()</tt> function returns the indexes at which the
substring ``or'' is found: 3, 23, 33.  In the <tt class="keyword">if</tt> statement,
<code>i</code> is first assigned a value of 3, but 3 is less than 5, so the
comparison fails, and Icon retries it with the second value of 23.  23
is greater than 5, so the comparison now succeeds, and the code prints
the value 23 to the screen.

<P>
Python doesn't go nearly as far as Icon in adopting generators as a
central concept.  Generators are considered a new part of the core
Python language, but learning or using them isn't compulsory; if they
don't solve any problems that you have, feel free to ignore them.
One novel feature of Python's interface as compared to
Icon's is that a generator's state is represented as a concrete object
(the iterator) that can be passed around to other functions or stored
in a data structure.

<P>
<div class="seealso">
  <p class="heading"><b>See Also:</b></p>

<P>
<dl compact class="seerfc">
    <dt><a href="http://python.sourceforge.net/peps/pep-0255.html"
        title="Simple Generators"
        >PEP 255, <em>Simple Generators</em></a>
    <dd>Written by Neil Schemenauer, Tim
Peters, Magnus Lie Hetland.  Implemented mostly by Neil Schemenauer
and Tim Peters, with other fixes from the Python Labs crew.
  </dl>

<P>
</div>

<P>

<H1><A NAME="SECTION000600000000000000000">
5 PEP 237: Unifying Long Integers and Integers</A>
</H1>

<P>
In recent versions, the distinction between regular integers, which
are 32-bit values on most machines, and long integers, which can be of
arbitrary size, was becoming an annoyance.  For example, on platforms
that support files larger than <code>2**32</code> bytes, the
<tt class="method">tell()</tt> method of file objects has to return a long integer.
However, there were various bits of Python that expected plain
integers and would raise an error if a long integer was provided
instead.  For example, in Python 1.5, only regular integers
could be used as a slice index, and <code>'abc'[1L:]</code> would raise a
<tt class="exception">TypeError</tt> exception with the message 'slice index must be
int'.

<P>
Python 2.2 will shift values from short to long integers as required.
The 'L' suffix is no longer needed to indicate a long integer literal,
as now the compiler will choose the appropriate type.  (Using the 'L'
suffix will be discouraged in future 2.x versions of Python,
triggering a warning in Python 2.4, and probably dropped in Python
3.0.)  Many operations that used to raise an <tt class="exception">OverflowError</tt>
will now return a long integer as their result.  For example:

<P>
<dl><dd><pre class="verbatim">
&gt;&gt;&gt; 1234567890123
1234567890123L
&gt;&gt;&gt; 2 ** 64
18446744073709551616L
</pre></dl>

<P>
In most cases, integers and long integers will now be treated
identically.  You can still distinguish them with the
<tt class="function">type()</tt> built-in function, but that's rarely needed.  

<P>
<div class="seealso">
  <p class="heading"><b>See Also:</b></p>

<P>
<dl compact class="seerfc">
    <dt><a href="http://python.sourceforge.net/peps/pep-0237.html"
        title="Unifying Long Integers and Integers"
        >PEP 237, <em>Unifying Long Integers and Integers</em></a>
    <dd>Written by
Moshe Zadka and Guido van Rossum.  Implemented mostly by Guido van
Rossum.
  </dl>

<P>
</div>

<P>

<H1><A NAME="SECTION000700000000000000000">
6 PEP 238: Changing the Division Operator</A>
</H1>

<P>
The most controversial change in Python 2.2 heralds the start of an effort
to fix an old design flaw that's been in Python from the beginning.
Currently Python's division operator, <code>/</code>, behaves like C's
division operator when presented with two integer arguments: it
returns an integer result that's truncated down when there would be
a fractional part.  For example, <code>3/2</code> is 1, not 1.5, and
<code>(-1)/2</code> is -1, not -0.5.  This means that the results of divison
can vary unexpectedly depending on the type of the two operands and
because Python is dynamically typed, it can be difficult to determine
the possible types of the operands.

<P>
(The controversy is over whether this is <i>really</i> a design flaw,
and whether it's worth breaking existing code to fix this.  It's
caused endless discussions on python-dev, and in July 2001 erupted into an
storm of acidly sarcastic postings on <a class="newsgroup" href="news:comp.lang.python">comp.lang.python</a>. I
won't argue for either side here and will stick to describing what's 
implemented in 2.2.  Read <a class="rfc" name="rfcref-1172"
href="http://python.sourceforge.net/peps/pep-0238.html">PEP 238</a> for a summary of arguments and
counter-arguments.)  

<P>
Because this change might break code, it's being introduced very
gradually.  Python 2.2 begins the transition, but the switch won't be
complete until Python 3.0.

<P>
First, I'll borrow some terminology from <a class="rfc" name="rfcref-1174"
href="http://python.sourceforge.net/peps/pep-0238.html">PEP 238</a>.  ``True division'' is the
division that most non-programmers are familiar with: 3/2 is 1.5, 1/4
is 0.25, and so forth.  ``Floor division'' is what Python's <code>/</code>
operator currently does when given integer operands; the result is the
floor of the value returned by true division.  ``Classic division'' is
the current mixed behaviour of <code>/</code>; it returns the result of
floor division when the operands are integers, and returns the result
of true division when one of the operands is a floating-point number.

<P>
Here are the changes 2.2 introduces:

<P>

<UL>
<LI>A new operator, <code>//</code>, is the floor division operator.
(Yes, we know it looks like C++'s comment symbol.)  <code>//</code>
<i>always</i> performs floor division no matter what the types of
its operands are, so <code>1 // 2</code> is 0 and <code>1.0 // 2.0</code> is also
0.0.

<P>
<code>//</code> is always available in Python 2.2; you don't need to enable
it using a <code>__future__</code> statement.  

<P>
</LI>
<LI>By including a <code>from __future__ import division</code> in a
module, the <code>/</code> operator will be changed to return the result of
true division, so <code>1/2</code> is 0.5.  Without the <code>__future__</code>
statement, <code>/</code> still means classic division.  The default meaning
of <code>/</code> will not change until Python 3.0.  

<P>
</LI>
<LI>Classes can define methods called <tt class="method">__truediv__</tt> and
<tt class="method">__floordiv__</tt> to overload the two division operators.  At the
C level, there are also slots in the <code>PyNumberMethods</code> structure
so extension types can define the two operators.

<P>
</LI>
<LI>Python 2.2 supports some command-line arguments for testing
whether code will works with the changed division semantics.  Running
python with <b class="programopt">-Q warn</b> will cause a warning to be issued
whenever division is applied to two integers.  You can use this to
find code that's affected by the change and fix it.  By default,
Python 2.2 will simply perform classic division without a warning; the
warning will be turned on by default in Python 2.3.

<P>
</LI>
</UL>

<P>
<div class="seealso">
  <p class="heading"><b>See Also:</b></p>

<P>
<dl compact class="seerfc">
    <dt><a href="http://python.sourceforge.net/peps/pep-0238.html"
        title="Changing the Division Operator"
        >PEP 238, <em>Changing the Division Operator</em></a>
    <dd>Written by Moshe Zadka and 
Guido van Rossum.  Implemented by Guido van Rossum..
  </dl>

<P>
</div>

<P>

<H1><A NAME="SECTION000800000000000000000">
7 Unicode Changes</A>
</H1>

<P>
Python's Unicode support has been enhanced a bit in 2.2.  Unicode
strings are usually stored as UCS-2, as 16-bit unsigned integers.
Python 2.2 can also be compiled to use UCS-4, 32-bit unsigned
integers, as its internal encoding by supplying
<b class="programopt">--enable-unicode=ucs4</b> to the configure script.  
(It's also possible to specify
<b class="programopt">--disable-unicode</b> to completely disable Unicode
support.)

<P>
When built to use UCS-4 (a ``wide Python''), the interpreter can
natively handle Unicode characters from U+000000 to U+110000, so the
range of legal values for the <tt class="function">unichr()</tt> function is expanded
accordingly.  Using an interpreter compiled to use UCS-2 (a ``narrow
Python''), values greater than 65535 will still cause
<tt class="function">unichr()</tt> to raise a <tt class="exception">ValueError</tt> exception.
This is all described in <a class="rfc" name="rfcref-1177"
href="http://python.sourceforge.net/peps/pep-0261.html">PEP 261</a>, ``Support for `wide' Unicode
characters''; consult it for further details.

<P>
Another change is simpler to explain. Since their introduction,
Unicode strings have supported an <tt class="method">encode()</tt> method to convert
the string to a selected encoding such as UTF-8 or Latin-1.  A
symmetric <tt class="method">decode(<big>[</big><var>encoding</var><big>]</big>)</tt> method has been
added to 8-bit strings (though not to Unicode strings) in 2.2.
<tt class="method">decode()</tt> assumes that the string is in the specified encoding
and decodes it, returning whatever is returned by the codec. 

<P>
Using this new feature, codecs have been added for tasks not directly
related to Unicode.  For example, codecs have been added for
uu-encoding, MIME's base64 encoding, and compression with the
<tt class="module">zlib</tt> module:

<P>
<dl><dd><pre class="verbatim">
&gt;&gt;&gt; s = """Here is a lengthy piece of redundant, overly verbose,
... and repetitive text.
... """
&gt;&gt;&gt; data = s.encode('zlib')
&gt;&gt;&gt; data
'x\x9c\r\xc9\xc1\r\x80 \x10\x04\xc0?Ul...'
&gt;&gt;&gt; data.decode('zlib')
'Here is a lengthy piece of redundant, overly verbose,\nand repetitive text.\n'
&gt;&gt;&gt; print s.encode('uu')
begin 666 &lt;data&gt;
M2&amp;5R92!I&lt;R!A(&amp;QE;F=T:'D@&lt;&amp;EE8V4@;V8@&lt;F5D=6YD86YT+"!O=F5R;'D@
&gt;=F5R8F]S92P*86YD(')E&lt;&amp;5T:71I=F4@=&amp;5X="X*

end
&gt;&gt;&gt; "sheesh".encode('rot-13')
'furrfu'
</pre></dl>

<P>
To convert a class instance to Unicode, a <tt class="method">__unicode__</tt> method
can be defined by a class, analogous to <tt class="method">__str__</tt>.

<P>
<tt class="method">encode()</tt>, <tt class="method">decode()</tt>, and <tt class="method">__unicode__</tt> were
implemented by Marc-Andr&#233; Lemburg.  The changes to support using
UCS-4 internally were implemented by Fredrik Lundh and Martin von
L&#246;wis.

<P>
<div class="seealso">
  <p class="heading"><b>See Also:</b></p>

<P>
<dl compact class="seerfc">
    <dt><a href="http://python.sourceforge.net/peps/pep-0261.html"
        title="Support for `wide' Unicode characters"
        >PEP 261, <em>Support for `wide' Unicode characters</em></a>
    <dd>Written by
Paul Prescod.
  </dl>

<P>
</div>

<P>

<H1><A NAME="SECTION000900000000000000000">
8 PEP 227: Nested Scopes</A>
</H1>

<P>
In Python 2.1, statically nested scopes were added as an optional
feature, to be enabled by a <code>from __future__ import
nested_scopes</code> directive.  In 2.2 nested scopes no longer need to be
specially enabled, and are now always present.  The rest of this section
is a copy of the description of nested scopes from my ``What's New in
Python 2.1'' document; if you read it when 2.1 came out, you can skip
the rest of this section.

<P>
The largest change introduced in Python 2.1, and made complete in 2.2,
is to Python's scoping rules.  In Python 2.0, at any given time there
are at most three namespaces used to look up variable names: local,
module-level, and the built-in namespace.  This often surprised people
because it didn't match their intuitive expectations.  For example, a
nested recursive function definition doesn't work:

<P>
<dl><dd><pre class="verbatim">
def f():
    ...
    def g(value):
        ...
        return g(value-1) + 1
    ...
</pre></dl>

<P>
The function <tt class="function">g()</tt> will always raise a <tt class="exception">NameError</tt>
exception, because the binding of the name "<tt class="samp">g</tt>" isn't in either
its local namespace or in the module-level namespace.  This isn't much
of a problem in practice (how often do you recursively define interior
functions like this?), but this also made using the <tt class="keyword">lambda</tt>
statement clumsier, and this was a problem in practice.  In code which
uses <tt class="keyword">lambda</tt> you can often find local variables being copied
by passing them as the default values of arguments.

<P>
<dl><dd><pre class="verbatim">
def find(self, name):
    "Return list of any entries equal to 'name'"
    L = filter(lambda x, name=name: x == name,
               self.list_attribute)
    return L
</pre></dl>

<P>
The readability of Python code written in a strongly functional style
suffers greatly as a result.

<P>
The most significant change to Python 2.2 is that static scoping has
been added to the language to fix this problem.  As a first effect,
the <code>name=name</code> default argument is now unnecessary in the above
example.  Put simply, when a given variable name is not assigned a
value within a function (by an assignment, or the <tt class="keyword">def</tt>,
<tt class="keyword">class</tt>, or <tt class="keyword">import</tt> statements), references to the
variable will be looked up in the local namespace of the enclosing
scope.  A more detailed explanation of the rules, and a dissection of
the implementation, can be found in the PEP.

<P>
This change may cause some compatibility problems for code where the
same variable name is used both at the module level and as a local
variable within a function that contains further function definitions.
This seems rather unlikely though, since such code would have been
pretty confusing to read in the first place.  

<P>
One side effect of the change is that the <code>from <var>module</var>
import *</code> and <tt class="keyword">exec</tt> statements have been made illegal inside
a function scope under certain conditions.  The Python reference
manual has said all along that <code>from <var>module</var> import *</code> is
only legal at the top level of a module, but the CPython interpreter
has never enforced this before.  As part of the implementation of
nested scopes, the compiler which turns Python source into bytecodes
has to generate different code to access variables in a containing
scope.  <code>from <var>module</var> import *</code> and <tt class="keyword">exec</tt> make it
impossible for the compiler to figure this out, because they add names
to the local namespace that are unknowable at compile time.
Therefore, if a function contains function definitions or
<tt class="keyword">lambda</tt> expressions with free variables, the compiler will
flag this by raising a <tt class="exception">SyntaxError</tt> exception.

<P>
To make the preceding explanation a bit clearer, here's an example:

<P>
<dl><dd><pre class="verbatim">
x = 1
def f():
    # The next line is a syntax error
    exec 'x=2'  
    def g():
        return x
</pre></dl>

<P>
Line 4 containing the <tt class="keyword">exec</tt> statement is a syntax error,
since <tt class="keyword">exec</tt> would define a new local variable named "<tt class="samp">x</tt>"whose value should be accessed by <tt class="function">g()</tt>.  

<P>
This shouldn't be much of a limitation, since <tt class="keyword">exec</tt> is rarely
used in most Python code (and when it is used, it's often a sign of a
poor design anyway).

<P>
<div class="seealso">
  <p class="heading"><b>See Also:</b></p>

<P>
<dl compact class="seerfc">
    <dt><a href="http://python.sourceforge.net/peps/pep-0227.html"
        title="Statically Nested Scopes"
        >PEP 227, <em>Statically Nested Scopes</em></a>
    <dd>Written and implemented by
Jeremy Hylton.
  </dl>

<P>
</div>

<P>

<H1><A NAME="SECTION0001000000000000000000">
9 New and Improved Modules</A>
</H1>

<P>

<UL>
<LI>The <tt class="module">xmlrpclib</tt> module was contributed to the standard
 library by Fredrik Lundh, provding support for writing XML-RPC
  clients.  XML-RPC is a simple remote procedure call protocol built on
  top of HTTP and XML. For example, the following snippet retrieves a
  list of RSS channels from the O'Reilly Network, and then 
  lists the recent headlines for one channel:

<P>
<dl><dd><pre class="verbatim">
import xmlrpclib
s = xmlrpclib.Server(
      'http://www.oreillynet.com/meerkat/xml-rpc/server.php')
channels = s.meerkat.getChannels()
# channels is a list of dictionaries, like this:
# [{'id': 4, 'title': 'Freshmeat Daily News'}
#  {'id': 190, 'title': '32Bits Online'},
#  {'id': 4549, 'title': '3DGamers'}, ... ]

# Get the items for one channel
items = s.meerkat.getItems( {'channel': 4} )

# 'items' is another list of dictionaries, like this:
# [{'link': 'http://freshmeat.net/releases/52719/', 
#   'description': 'A utility which converts HTML to XSL FO.', 
#   'title': 'html2fo 0.3 (Default)'}, ... ]
</pre></dl>

<P>
The <tt class="module">SimpleXMLRPCServer</tt> module makes it easy to create
straightforward XML-RPC servers.  See <a class="url" href="http://www.xmlrpc.com/">http://www.xmlrpc.com/</a> for
more information about XML-RPC.

<P>
</LI>
<LI>The new <tt class="module">hmac</tt> module implements the HMAC
  algorithm described by <a class="rfc" name="rfcref-1181"
href="http://www.faqs.org/rfcs/rfc2104.html">RFC 2104</a>.
  (Contributed by Gerhard H&#228;ring.)

<P>
</LI>
<LI>Several functions that originally returned lengthy tuples now
  return pseudo-sequences that still behave like tuples but also have
  mnemonic attributes such as memberst_mtime or <tt class="member">tm_year</tt>.
  The enhanced functions include <tt class="function">stat()</tt>,
  <tt class="function">fstat()</tt>, <tt class="function">statvfs()</tt>, and <tt class="function">fstatvfs()</tt>
  in the <tt class="module">os</tt> module, and <tt class="function">localtime()</tt>,
  <tt class="function">gmtime()</tt>, and <tt class="function">strptime()</tt> in the <tt class="module">time</tt>
  module.  

<P>
For example, to obtain a file's size using the old tuples, you'd end
  up writing something like <code>file_size =
  os.stat(filename)[stat.ST_SIZE]</code>, but now this can be written more
  clearly as <code>file_size = os.stat(filename).st_size</code>.

<P>
The original patch for this feature was contributed by Nick Mathewson.

<P>
</LI>
<LI>The Python profiler has been extensively reworked and various
  errors in its output have been corrected.  (Contributed by Fred
  Fred&nbsp;L. Drake, Jr. and Tim Peters.)

<P>
</LI>
<LI>The <tt class="module">socket</tt> module can be compiled to support IPv6;
  specify the <b class="programopt">--enable-ipv6</b> option to Python's configure
  script.  (Contributed by Jun-ichiro ``itojun'' Hagino.)

<P>
</LI>
<LI>Two new format characters were added to the <tt class="module">struct</tt>
  module for 64-bit integers on platforms that support the C
  <tt class="ctype">long long</tt> type.  "<tt class="samp">q</tt>" is for a signed 64-bit integer,
  and "<tt class="samp">Q</tt>" is for an unsigned one.  The value is returned in
  Python's long integer type.  (Contributed by Tim Peters.)

<P>
</LI>
<LI>In the interpreter's interactive mode, there's a new built-in
  function <tt class="function">help()</tt> that uses the <tt class="module">pydoc</tt> module
  introduced in Python 2.1 to provide interactive help.
  <code>help(<var>object</var>)</code> displays any available help text about
  <var>object</var>.  <code>help()</code> with no argument puts you in an online
  help utility, where you can enter the names of functions, classes,
  or modules to read their help text.
  (Contributed by Guido van Rossum, using Ka-Ping Yee's <tt class="module">pydoc</tt> module.)

<P>
</LI>
<LI>Various bugfixes and performance improvements have been made
  to the SRE engine underlying the <tt class="module">re</tt> module.  For example,
  the <tt class="function">re.sub()</tt> and <tt class="function">re.split()</tt> functions have
  been rewritten in C.  Another contributed patch speeds up certain
  Unicode character ranges by a factor of two, and a new <tt class="method">finditer()</tt> 
  method that returns an iterator over all the non-overlapping matches in 
  a given string. 
  (SRE is maintained by
  Fredrik Lundh.  The BIGCHARSET patch was contributed by Martin von
  L&#246;wis.)

<P>
</LI>
<LI>The <tt class="module">smtplib</tt> module now supports <a class="rfc" name="rfcref-1183"
href="http://www.faqs.org/rfcs/rfc2487.html">RFC 2487</a>, ``Secure
  SMTP over TLS'', so it's now possible to encrypt the SMTP traffic
  between a Python program and the mail transport agent being handed a
  message.  <tt class="module">smtplib</tt> also supports SMTP authentication. 
  (Contributed by Gerhard H&#228;ring.)

<P>
</LI>
<LI>The <tt class="module">imaplib</tt> module, maintained by Piers Lauder, has
  support for several new extensions: the NAMESPACE extension defined
  in <a class="rfc" name="rfcref-1185"
href="http://www.faqs.org/rfcs/rfc2342.html">RFC 2342</a>, SORT, GETACL and SETACL.  (Contributed by Anthony
  Baxter and Michel Pelletier.)

<P>
</LI>
<LI>The <tt class="module">rfc822</tt> module's parsing of email addresses is now
  compliant with <a class="rfc" name="rfcref-1187"
href="http://www.faqs.org/rfcs/rfc2822.html">RFC 2822</a>, an update to <a class="rfc" name="rfcref-1189"
href="http://www.faqs.org/rfcs/rfc822.html">RFC 822</a>.  (The module's
  name is <i>not</i> going to be changed to "<tt class="samp">rfc2822</tt>".)  A new
  package, <tt class="module">email</tt>, has also been added for parsing and
  generating e-mail messages.  (Contributed by Barry Warsaw, and
  arising out of his work on Mailman.)

<P>
</LI>
<LI>The <tt class="module">difflib</tt> module now contains a new <tt class="class">Differ</tt>
  class for producing human-readable lists of changes (a ``delta'')
  between two sequences of lines of text.  There are also two
  generator functions, <tt class="function">ndiff()</tt> and <tt class="function">restore()</tt>,
  which respectively return a delta from two sequences, or one of the
  original sequences from a delta. (Grunt work contributed by David
  Goodger, from ndiff.py code by Tim Peters who then did the
  generatorization.)

<P>
</LI>
<LI>New constants <tt class="constant">ascii_letters</tt>,
  <tt class="constant">ascii_lowercase</tt>, and <tt class="constant">ascii_uppercase</tt> were
  added to the <tt class="module">string</tt> module.  There were several modules in
  the standard library that used <tt class="constant">string.letters</tt> to mean the
  ranges A-Za-z, but that assumption is incorrect when locales are in
  use, because <tt class="constant">string.letters</tt> varies depending on the set
  of legal characters defined by the current locale.  The buggy
  modules have all been fixed to use <tt class="constant">ascii_letters</tt> instead.
  (Reported by an unknown person; fixed by Fred&nbsp;L. Drake, Jr.)

<P>
</LI>
<LI>The <tt class="module">mimetypes</tt> module now makes it easier to use
  alternative MIME-type databases by the addition of a
  <tt class="class">MimeTypes</tt> class, which takes a list of filenames to be
  parsed.  (Contributed by Fred&nbsp;L. Drake, Jr.)

<P>
</LI>
<LI>A <tt class="class">Timer</tt> class was added to the <tt class="module">threading</tt>
  module that allows scheduling an activity to happen at some future
  time.  (Contributed by Itamar Shtull-Trauring.)

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION0001100000000000000000">
10 Interpreter Changes and Fixes</A>
</H1>

<P>
Some of the changes only affect people who deal with the Python
interpreter at the C level because they're writing Python extension modules,
embedding the interpreter, or just hacking on the interpreter itself.
If you only write Python code, none of the changes described here will
affect you very much.

<P>

<UL>
<LI>Profiling and tracing functions can now be implemented in C,
  which can operate at much higher speeds than Python-based functions
  and should reduce the overhead of profiling and tracing.  This 
  will be of interest to authors of development environments for
  Python.  Two new C functions were added to Python's API,
  <tt class="cfunction">PyEval_SetProfile()</tt> and <tt class="cfunction">PyEval_SetTrace()</tt>.
  The existing <tt class="function">sys.setprofile()</tt> and
  <tt class="function">sys.settrace()</tt> functions still exist, and have simply
  been changed to use the new C-level interface.  (Contributed by Fred
  L. Drake, Jr.)

<P>
</LI>
<LI>Another low-level API, primarily of interest to implementors
  of Python debuggers and development tools, was added.
  <tt class="cfunction">PyInterpreterState_Head()</tt> and
  <tt class="cfunction">PyInterpreterState_Next()</tt> let a caller walk through all
  the existing interpreter objects;
  <tt class="cfunction">PyInterpreterState_ThreadHead()</tt> and
  <tt class="cfunction">PyThreadState_Next()</tt> allow looping over all the thread
  states for a given interpreter.  (Contributed by David Beazley.)

<P>
</LI>
<LI>A new "<tt class="samp">et</tt>" format sequence was added to
  <tt class="cfunction">PyArg_ParseTuple</tt>; "<tt class="samp">et</tt>" takes both a parameter and
  an encoding name, and converts the parameter to the given encoding
  if the parameter turns out to be a Unicode string, or leaves it
  alone if it's an 8-bit string, assuming it to already be in the
  desired encoding.  This differs from the "<tt class="samp">es</tt>" format character,
  which assumes that 8-bit strings are in Python's default ASCII
  encoding and converts them to the specified new encoding.
  (Contributed by M.-A. Lemburg, and used for the MBCS support on
  Windows described in the following section.)

<P>
</LI>
<LI>A different argument parsing function,
  <tt class="cfunction">PyArg_UnpackTuple()</tt>, has been added that's simpler and
  presumably faster.  Instead of specifying a format string, the
  caller simply gives the minimum and maximum number of arguments
  expected, and a set of pointers to <code>PyObject*</code> variables that
  will be filled in with argument values.  

<P>
</LI>
<LI>Two new flags <tt class="constant">METH_NOARGS</tt> and <tt class="constant">METH_O</tt> are
   available in method definition tables to simplify implementation of
   methods with no arguments or a single untyped argument. Calling
   such methods is more efficient than calling a corresponding method
   that uses <tt class="constant">METH_VARARGS</tt>. 
   Also, the old <tt class="constant">METH_OLDARGS</tt> style of writing C methods is 
   now officially deprecated.  

<P>
</LI>
<LI>Two new wrapper functions, <tt class="cfunction">PyOS_snprintf()</tt> and
   <tt class="cfunction">PyOS_vsnprintf()</tt> were added to provide 
   cross-platform implementations for the relatively new
   <tt class="cfunction">snprintf()</tt> and <tt class="cfunction">vsnprintf()</tt> C lib APIs. In
   contrast to the standard <tt class="cfunction">sprintf()</tt> and
   <tt class="cfunction">vsprintf()</tt> functions, the Python versions check the
   bounds of the buffer used to protect against buffer overruns.
   (Contributed by M.-A. Lemburg.)

<P>
</LI>
<LI>The <tt class="cfunction">_PyTuple_Resize()</tt> function has lost an unused
   parameter, so now it takes 2 parameters instead of 3.  The third
   argument was never used, and can simply be discarded when porting
   code from earlier versions to Python 2.2.

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION0001200000000000000000">
11 Other Changes and Fixes</A>
</H1>

<P>
As usual there were a bunch of other improvements and bugfixes
scattered throughout the source tree.  A search through the CVS change
logs finds there were 527 patches applied, and 683 bugs fixed; both
figures are likely to be underestimates.  Some of the more notable
changes are:

<P>

<UL>
<LI>The code for the MacOS port for Python, maintained by Jack
  Jansen, is now kept in the main Python CVS tree, and many changes
  have been made to support MacOS&nbsp;X.

<P>
The most significant change is the ability to build Python as a
framework, enabled by supplying the <b class="programopt">--enable-framework</b>
option to the configure script when compiling Python.  According to
Jack Jansen, ``This installs a self-contained Python installation plus
the OS&nbsp;X framework "glue" into
<span class="file">/Library/Frameworks/Python.framework</span> (or another location of
choice).  For now there is little immediate added benefit to this
(actually, there is the disadvantage that you have to change your PATH
to be able to find Python), but it is the basis for creating a
full-blown Python application, porting the MacPython IDE, possibly
using Python as a standard OSA scripting language and much more.''

<P>
Most of the MacPython toolbox modules, which interface to MacOS APIs
such as windowing, QuickTime, scripting, etc. have been ported to OS&nbsp;X,
but they've been left commented out in <span class="file">setup.py</span>.  People who want
to experiment with these modules can uncomment them manually.

<P>
</LI>
<LI>Keyword arguments passed to builtin functions that don't take them
  now cause a <tt class="exception">TypeError</tt> exception to be raised, with the
  message "<var>function</var> takes no keyword arguments".

<P>
</LI>
<LI>Weak references, added in Python 2.1 as an extension module,
  are now part of the core because they're used in the implementation
  of new-style classes.  The <tt class="exception">ReferenceError</tt> exception has
  therefore moved from the <tt class="module">weakref</tt> module to become a
  built-in exception.

<P>
</LI>
<LI>A new script, <span class="file">Tools/scripts/cleanfuture.py</span> by Tim
  Peters, automatically removes obsolete <code>__future__</code> statements
  from Python source code.

<P>
</LI>
<LI>An additional <var>flags</var> argument has been added to the
  built-in function <tt class="function">compile()</tt>, so the behaviour of
  <code>__future__</code> statements can now be correctly observed in
  simulated shells, such as those presented by IDLE and other
  development environments.  This is described in <a class="rfc" name="rfcref-1193"
href="http://python.sourceforge.net/peps/pep-0264.html">PEP 264</a>.
  (Contributed by Michael Hudson.)

<P>
</LI>
<LI>The new license introduced with Python 1.6 wasn't
  GPL-compatible.  This is fixed by some minor textual changes to the
  2.2 license, so it's now legal to embed Python inside a GPLed
  program again.  Note that Python itself is not GPLed, but instead is
  under a license that's essentially equivalent to the BSD license,
  same as it always was.  The license changes were also applied to the
  Python 2.0.1 and 2.1.1 releases.

<P>
</LI>
<LI>When presented with a Unicode filename on Windows, Python will
  now convert it to an MBCS encoded string, as used by the Microsoft
  file APIs.  As MBCS is explicitly used by the file APIs, Python's
  choice of ASCII as the default encoding turns out to be an
  annoyance.  On Unix, the locale's character set is used if
  <tt class="function">locale.nl_langinfo(CODESET)</tt> is available.  (Windows
  support was contributed by Mark Hammond with assistance from
  Marc-Andr&#233; Lemburg. Unix support was added by Martin von L&#246;wis.)

<P>
</LI>
<LI>Large file support is now enabled on Windows.  (Contributed by
  Tim Peters.)

<P>
</LI>
<LI>The <span class="file">Tools/scripts/ftpmirror.py</span> script
  now parses a <span class="file">.netrc</span> file, if you have one.
  (Contributed by Mike Romberg.) 

<P>
</LI>
<LI>Some features of the object returned by the
  <tt class="function">xrange()</tt> function are now deprecated, and trigger
  warnings when they're accessed; they'll disappear in Python 2.3.
  <tt class="class">xrange</tt> objects tried to pretend they were full sequence
  types by supporting slicing, sequence multiplication, and the
  <tt class="keyword">in</tt> operator, but these features were rarely used and
  therefore buggy.  The <tt class="method">tolist()</tt> method and the
  <tt class="member">start</tt>, <tt class="member">stop</tt>, and <tt class="member">step</tt> attributes are also
  being deprecated.  At the C level, the fourth argument to the
  <tt class="cfunction">PyRange_New()</tt> function, "<tt class="samp">repeat</tt>", has also been
  deprecated.

<P>
</LI>
<LI>There were a bunch of patches to the dictionary
  implementation, mostly to fix potential core dumps if a dictionary
  contains objects that sneakily changed their hash value, or mutated
  the dictionary they were contained in. For a while python-dev fell
  into a gentle rhythm of Michael Hudson finding a case that dumped
  core, Tim Peters fixing the bug, Michael finding another case, and round
  and round it went.   

<P>
</LI>
<LI>On Windows, Python can now be compiled with Borland C thanks
  to a number of patches contributed by Stephen Hansen, though the
  result isn't fully functional yet.  (But this <i>is</i> progress...)

<P>
</LI>
<LI>Another Windows enhancement: Wise Solutions generously offered
  PythonLabs use of their InstallerMaster 8.1 system.  Earlier
  PythonLabs Windows installers used Wise 5.0a, which was beginning to
  show its age.  (Packaged up by Tim Peters.)

<P>
</LI>
<LI>Files ending in "<tt class="samp">.pyw</tt>" can now be imported on Windows.
  "<tt class="samp">.pyw</tt>" is a Windows-only thing, used to indicate that a script
  needs to be run using PYTHONW.EXE instead of PYTHON.EXE in order to
  prevent a DOS console from popping up to display the output.  This
  patch makes it possible to import such scripts, in case they're also
  usable as modules.  (Implemented by David Bolen.)

<P>
</LI>
<LI>On platforms where Python uses the C <tt class="cfunction">dlopen()</tt> function 
  to load extension modules, it's now possible to set the flags used 
  by <tt class="cfunction">dlopen()</tt> using the <tt class="function">sys.getdlopenflags()</tt> and
  <tt class="function">sys.setdlopenflags()</tt> functions.    (Contributed by Bram Stolk.)

<P>
</LI>
<LI>The <tt class="function">pow()</tt> built-in function no longer supports 3
  arguments when floating-point numbers are supplied.
  <code>pow(<var>x</var>, <var>y</var>, <var>z</var>)</code> returns <code>(x**y) % z</code>, but
  this is never useful for floating point numbers, and the final
  result varies unpredictably depending on the platform.  A call such
  as <code>pow(2.0, 8.0, 7.0)</code> will now raise a <tt class="exception">TypeError</tt>
  exception.

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION0001300000000000000000">
12 Acknowledgements</A>
</H1>

<P>
The author would like to thank the following people for offering
suggestions, corrections and assistance with various drafts of this
article: Fred Bremmer, Keith Briggs, Andrew Dalke, Fred&nbsp;L. Drake, Jr.,
Carel Fellinger, David Goodger, Mark Hammond, Stephen Hansen, Michael
Hudson, Jack Jansen, Marc-Andr&#233; Lemburg, Martin von L&#246;wis, Fredrik
Lundh, Michael McLay, Nick Mathewson, Paul Moore, Gustavo Niemeyer,
Don O'Donnell, Tim Peters, Jens Quade, Tom Reinhardt, Neil
Schemenauer, Guido van Rossum, Greg Ward.

<P>

<H1><A NAME="SECTION0001400000000000000000">
About this document ...</A>
</H1>
 <strong>What's New in Python 2.2</strong>
<p> This document was generated using the <a
    href="http://saftsack.fs.uni-bayreuth.de/~latex2ht/">
    <strong>LaTeX</strong>2<tt>HTML</tt></a> translator.
</p>

<p> <a
    href="http://saftsack.fs.uni-bayreuth.de/~latex2ht/">
    <strong>LaTeX</strong>2<tt>HTML</tt></a> is Copyright &copy;
  1993, 1994, 1995, 1996, 1997, <a
    href="http://cbl.leeds.ac.uk/nikos/personal.html">Nikos
    Drakos</a>, Computer Based Learning Unit, University of
  Leeds, and Copyright &copy; 1997, 1998, <a
    href="http://www.maths.mq.edu.au/~ross/">Ross
    Moore</a>, Mathematics Department, Macquarie University,
  Sydney.
</p>

<p> The application of <a
    href="http://saftsack.fs.uni-bayreuth.de/~latex2ht/">
    <strong>LaTeX</strong>2<tt>HTML</tt></a> to the Python
  documentation has been heavily tailored by Fred L. Drake,
  Jr.  Original navigation icons were contributed by Christopher
  Petrilli.
</p>

<hr>
<span class="release-info">Release 1.00.</span>

</BODY>
</HTML>
