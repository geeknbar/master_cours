<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>What's New in Python 2.0</title>
<META NAME="description" CONTENT="What's New in Python 2.0">
<META NAME="keywords" CONTENT="python-20">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<meta http-equiv="Content-Type" content="text/html; charset=">
<link rel="first" href="index.html">
<link rel="contents" href="contents.html" title="Contents">

<link rel="stylesheet" href="../style.css" type="text/css">
</head>
<body>
<div class="titlepage">
<center>
<table width="100%" border="0" cellspacing="0" cellpadding="1">
<tr class="header">
<td>
<table class="navigation" width="100%" border="0" cellspacing="0" cellpadding="3">
<tr>
<td align="center">What's New in Python 2.0</td>
</tr>
</table>
</td>
</tr>
</table>
<p><span class="authorname">A.M. Kuchling and Moshe Zadka</span></p>
<p><span class="authoremail">akuchling@mems-exhcange.org</span>, <span class="authoremail">moshez@math.huji.ac.il</span></p>
</center>
</div>
<BR><H2><A NAME="SECTION000100000000000000000">
Contents</A>
</H2>
<!--Table of Contents-->

<UL>
<LI><A href="index.html">Contents</a>
<LI><A href="index.html#SECTION000200000000000000000">1 Introduction</a>
<LI><A href="index.html#SECTION000300000000000000000">2 What About Python 1.6?</a>
<LI><A href="index.html#SECTION000400000000000000000">3 New Development Process</a>
<LI><A href="index.html#SECTION000500000000000000000">4 Unicode</a>
<LI><A href="index.html#SECTION000600000000000000000">5 List Comprehensions</a>
<LI><A href="index.html#SECTION000700000000000000000">6 Augmented Assignment</a>
<LI><A href="index.html#SECTION000800000000000000000">7 String Methods</a>
<LI><A href="index.html#SECTION000900000000000000000">8 Garbage Collection of Cycles</a>
<LI><A href="index.html#SECTION0001000000000000000000">9 Other Core Changes</a>
<UL>
<LI><A href="index.html#SECTION0001010000000000000000">9.1 Minor Language Changes</a>
<LI><A href="index.html#SECTION0001020000000000000000">9.2 Changes to Built-in Functions</a>
</ul>
<LI><A href="index.html#SECTION0001100000000000000000">10 Porting to 2.0</a>
<LI><A href="index.html#SECTION0001200000000000000000">11 Extending/Embedding Changes</a>
<LI><A href="index.html#SECTION0001300000000000000000">12 Distutils: Making Modules Easy to Install</a>
<LI><A href="index.html#SECTION0001400000000000000000">13 XML Modules</a>
<UL>
<LI><A href="index.html#SECTION0001410000000000000000">13.1 SAX2 Support</a>
<LI><A href="index.html#SECTION0001420000000000000000">13.2 DOM Support</a>
<LI><A href="index.html#SECTION0001430000000000000000">13.3 Relationship to PyXML</a>
</ul>
<LI><A href="index.html#SECTION0001500000000000000000">14 Module changes</a>
<LI><A href="index.html#SECTION0001600000000000000000">15 New modules</a>
<LI><A href="index.html#SECTION0001700000000000000000">16 IDLE Improvements</a>
<LI><A href="index.html#SECTION0001800000000000000000">17 Deleted and Deprecated Modules</a>
<LI><A href="index.html#SECTION0001900000000000000000">18 Acknowledgements</a>
<LI><A href="index.html#SECTION0002000000000000000000">About this document ...</a>
</ul>
<!--End of Table of Contents-->
<P>

<H1><A NAME="SECTION000200000000000000000">
1 Introduction</A>
</H1>

<P>
A new release of Python, version 2.0, was released on October 16, 2000. This
article covers the exciting new features in 2.0, highlights some other
useful changes, and points out a few incompatible changes that may require
rewriting code.

<P>
Python's development never completely stops between releases, and a
steady flow of bug fixes and improvements are always being submitted.
A host of minor fixes, a few optimizations, additional docstrings, and
better error messages went into 2.0; to list them all would be
impossible, but they're certainly significant.  Consult the
publicly-available CVS logs if you want to see the full list.  This
progress is due to the five developers working for 
PythonLabs are now getting paid to spend their days fixing bugs,
and also due to the improved communication resulting 
from moving to SourceForge.

<P>

<H1><A NAME="SECTION000300000000000000000">
2 What About Python 1.6?</A>
</H1>

<P>
Python 1.6 can be thought of as the Contractual Obligations Python
release.  After the core development team left CNRI in May 2000, CNRI
requested that a 1.6 release be created, containing all the work on
Python that had been performed at CNRI.  Python 1.6 therefore
represents the state of the CVS tree as of May 2000, with the most
significant new feature being Unicode support.  Development continued
after May, of course, so the 1.6 tree received a few fixes to ensure
that it's forward-compatible with Python 2.0.  1.6 is therefore part
of Python's evolution, and not a side branch.

<P>
So, should you take much interest in Python 1.6?  Probably not.  The
1.6final and 2.0beta1 releases were made on the same day (September 5,
2000), the plan being to finalize Python 2.0 within a month or so.  If
you have applications to maintain, there seems little point in
breaking things by moving to 1.6, fixing them, and then having another
round of breakage within a month by moving to 2.0; you're better off
just going straight to 2.0.  Most of the really interesting features
described in this document are only in 2.0, because a lot of work was
done between May and September.  

<P>

<H1><A NAME="SECTION000400000000000000000">
3 New Development Process</A>
</H1>

<P>
The most important change in Python 2.0 may not be to the code at all,
but to how Python is developed: in May 2000 the Python developers
began using the tools made available by SourceForge for storing 
source code, tracking bug reports, and managing the queue of patch
submissions.  To report bugs or submit patches for Python 2.0, use the
bug tracking and patch manager tools available from Python's project
page, located at <a class="url" href="http://sourceforge.net/projects/python/">http://sourceforge.net/projects/python/</a>.

<P>
The most important of the services now hosted at SourceForge is the
Python CVS tree, the version-controlled repository containing the
source code for Python.  Previously, there were roughly 7 or so people
who had write access to the CVS tree, and all patches had to be
inspected and checked in by one of the people on this short list.
Obviously, this wasn't very scalable.  By moving the CVS tree to
SourceForge, it became possible to grant write access to more people;
as of September 2000 there were 27 people able to check in changes, a
fourfold increase.  This makes possible large-scale changes that
wouldn't be attempted if they'd have to be filtered through the small
group of core developers.  For example, one day Peter Schneider-Kamp
took it into his head to drop K&amp;R C compatibility and convert the C
source for Python to ANSI C. After getting approval on the python-dev
mailing list, he launched into a flurry of checkins that lasted about
a week, other developers joined in to help, and the job was done.  If
there were only 5 people with write access, probably that task would
have been viewed as ``nice, but not worth the time and effort needed''
and it would never have gotten done.

<P>
The shift to using SourceForge's services has resulted in a remarkable
increase in the speed of development.  Patches now get submitted,
commented on, revised by people other than the original submitter, and
bounced back and forth between people until the patch is deemed worth
checking in.  Bugs are tracked in one central location and can be
assigned to a specific person for fixing, and we can count the number
of open bugs to measure progress.  This didn't come without a cost:
developers now have more e-mail to deal with, more mailing lists to
follow, and special tools had to be written for the new environment.
For example, SourceForge sends default patch and bug notification
e-mail messages that are completely unhelpful, so Ka-Ping Yee wrote an
HTML screen-scraper that sends more useful messages.

<P>
The ease of adding code caused a few initial growing pains, such as
code was checked in before it was ready or without getting clear
agreement from the developer group.  The approval process that has
emerged is somewhat similar to that used by the Apache group.
Developers can vote +1, +0, -0, or -1 on a patch; +1 and -1 denote
acceptance or rejection, while +0 and -0 mean the developer is mostly
indifferent to the change, though with a slight positive or negative
slant.  The most significant change from the Apache model is that the
voting is essentially advisory, letting Guido van Rossum, who has
Benevolent Dictator For Life status, know what the general opinion is.
He can still ignore the result of a vote, and approve or
reject a change even if the community disagrees with him.

<P>
Producing an actual patch is the last step in adding a new feature,
and is usually easy compared to the earlier task of coming up with a
good design.  Discussions of new features can often explode into
lengthy mailing list threads, making the discussion hard to follow,
and no one can read every posting to python-dev.  Therefore, a
relatively formal process has been set up to write Python Enhancement
Proposals (PEPs), modelled on the Internet RFC process.  PEPs are
draft documents that describe a proposed new feature, and are
continually revised until the community reaches a consensus, either
accepting or rejecting the proposal.  Quoting from the introduction to
PEP 1, ``PEP Purpose and Guidelines'':

<P>
<BLOCKQUOTE>
PEP stands for Python Enhancement Proposal.  A PEP is a design
    document providing information to the Python community, or
    describing a new feature for Python.  The PEP should provide a
    concise technical specification of the feature and a rationale for
    the feature.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>We intend PEPs to be the primary mechanisms for proposing new
    features, for collecting community input on an issue, and for
    documenting the design decisions that have gone into Python.  The
    PEP author is responsible for building consensus within the
    community and documenting dissenting opinions.

</BLOCKQUOTE>

<P>
Read the rest of PEP 1 for the details of the PEP editorial process,
style, and format.  PEPs are kept in the Python CVS tree on
SourceForge, though they're not part of the Python 2.0 distribution,
and are also available in HTML form from
<a class="url" href="http://python.sourceforge.net/peps/">http://python.sourceforge.net/peps/</a>.  As of September 2000,
there are 25 PEPS, ranging from PEP 201, ``Lockstep Iteration'', to
PEP 225, ``Elementwise/Objectwise Operators''.

<P>

<H1><A NAME="SECTION000500000000000000000">
4 Unicode</A>
</H1>

<P>
The largest new feature in Python 2.0 is a new fundamental data type:
Unicode strings.  Unicode uses 16-bit numbers to represent characters
instead of the 8-bit number used by ASCII, meaning that 65,536
distinct characters can be supported.

<P>
The final interface for Unicode support was arrived at through
countless often-stormy discussions on the python-dev mailing list, and
mostly implemented by Marc-Andr&#233; Lemburg, based on a Unicode string
type implementation by Fredrik Lundh.  A detailed explanation of the
interface is in the file <span class="file">Misc/unicode.txt</span> in the Python source
distribution; it's also available on the Web at
<a class="url" href="http://starship.python.net/crew/lemburg/unicode-proposal.txt">http://starship.python.net/crew/lemburg/unicode-proposal.txt</a>.
This article will simply cover the most significant points about the Unicode 
interfaces.

<P>
In Python source code, Unicode strings are written as
<code>u"string"</code>.  Arbitrary Unicode characters can be written using a
new escape sequence, <code>&#92;u<var>HHHH</var></code>, where <var>HHHH</var> is a
4-digit hexadecimal number from 0000 to FFFF.  The existing
<code>&#92;x<var>HHHH</var></code> escape sequence can also be used, and octal
escapes can be used for characters up to U+01FF, which is represented
by <code>&#92;777</code>.

<P>
Unicode strings, just like regular strings, are an immutable sequence
type.  They can be indexed and sliced, but not modified in place.
Unicode strings have an <tt class="method">encode( <big>[</big>encoding<big>]</big> )</tt> method
that returns an 8-bit string in the desired encoding.  Encodings are
named by strings, such as <code>'ascii'</code>, <code>'utf-8'</code>,
<code>'iso-8859-1'</code>, or whatever.  A codec API is defined for
implementing and registering new encodings that are then available
throughout a Python program.  If an encoding isn't specified, the
default encoding is usually 7-bit ASCII, though it can be changed for
your Python installation by calling the
<tt class="function">sys.setdefaultencoding(<var>encoding</var>)</tt> function in a
customised version of <span class="file">site.py</span>.

<P>
Combining 8-bit and Unicode strings always coerces to Unicode, using
the default ASCII encoding; the result of <code>'a' + u'bc'</code> is
<code>u'abc'</code>.

<P>
New built-in functions have been added, and existing built-ins
modified to support Unicode:

<P>

<UL>
<LI><code>unichr(<var>ch</var>)</code> returns a Unicode string 1 character
long, containing the character <var>ch</var>.

<P>
</LI>
<LI><code>ord(<var>u</var>)</code>, where <var>u</var> is a 1-character regular or Unicode string, returns the number of the character as an integer.

<P>
</LI>
<LI><code>unicode(<var>string</var> <big>[</big>, <var>encoding</var><big>]</big> 
<big>[</big>, <var>errors</var><big>]</big> ) </code> creates a Unicode string from an 8-bit
string.  <code>encoding</code> is a string naming the encoding to use.
The <code>errors</code> parameter specifies the treatment of characters that
are invalid for the current encoding; passing <code>'strict'</code> as the
value causes an exception to be raised on any encoding error, while
<code>'ignore'</code> causes errors to be silently ignored and
<code>'replace'</code> uses U+FFFD, the official replacement character, in
case of any problems.

<P>
</LI>
<LI>The <tt class="keyword">exec</tt> statement, and various built-ins such as
<code>eval()</code>, <code>getattr()</code>, and <code>setattr()</code> will also
accept Unicode strings as well as regular strings.  (It's possible
that the process of fixing this missed some built-ins; if you find a
built-in function that accepts strings but doesn't accept Unicode
strings at all, please report it as a bug.)

<P>
</LI>
</UL>

<P>
A new module, <tt class="module">unicodedata</tt>, provides an interface to Unicode
character properties.  For example, <code>unicodedata.category(u'A')</code>
returns the 2-character string 'Lu', the 'L' denoting it's a letter,
and 'u' meaning that it's uppercase.
<code>u.bidirectional(u'&#92;x0660')</code> returns 'AN', meaning that U+0660 is
an Arabic number.

<P>
The <tt class="module">codecs</tt> module contains functions to look up existing encodings
and register new ones.  Unless you want to implement a
new encoding, you'll most often use the
<tt class="function">codecs.lookup(<var>encoding</var>)</tt> function, which returns a
4-element tuple: <code>(<var>encode_func</var>,
<var>decode_func</var>, <var>stream_reader</var>, <var>stream_writer</var>)</code>.

<P>

<UL>
<LI><var>encode_func</var> is a function that takes a Unicode string, and
returns a 2-tuple <code>(<var>string</var>, <var>length</var>)</code>.  <var>string</var>
is an 8-bit string containing a portion (perhaps all) of the Unicode
string converted into the given encoding, and <var>length</var> tells you
how much of the Unicode string was converted.

<P>
</LI>
<LI><var>decode_func</var> is the opposite of <var>encode_func</var>, taking
an 8-bit string and returning a 2-tuple <code>(<var>ustring</var>,
<var>length</var>)</code>, consisting of the resulting Unicode string
<var>ustring</var> and the integer <var>length</var> telling how much of the
8-bit string was consumed.

<P>
</LI>
<LI><var>stream_reader</var> is a class that supports decoding input from
a stream.  <var>stream_reader(<var>file_obj</var>)</var> returns an object that
supports the <tt class="method">read()</tt>, <tt class="method">readline()</tt>, and
<tt class="method">readlines()</tt> methods.  These methods will all translate from
the given encoding and return Unicode strings.

<P>
</LI>
<LI><var>stream_writer</var>, similarly, is a class that supports
encoding output to a stream.  <var>stream_writer(<var>file_obj</var>)</var>
returns an object that supports the <tt class="method">write()</tt> and
<tt class="method">writelines()</tt> methods.  These methods expect Unicode strings,
translating them to the given encoding on output.
</LI>
</UL>

<P>
For example, the following code writes a Unicode string into a file, 
encoding it as UTF-8:

<P>
<dl><dd><pre class="verbatim">
import codecs

unistr = u'\u0660\u2000ab ...'

(UTF8_encode, UTF8_decode,
 UTF8_streamreader, UTF8_streamwriter) = codecs.lookup('UTF-8')

output = UTF8_streamwriter( open( '/tmp/output', 'wb') )
output.write( unistr )
output.close()
</pre></dl>

<P>
The following code would then read UTF-8 input from the file:

<P>
<dl><dd><pre class="verbatim">
input = UTF8_streamreader( open( '/tmp/output', 'rb') )
print repr(input.read())
input.close()
</pre></dl>

<P>
Unicode-aware regular expressions are available through the
<tt class="module">re</tt> module, which has a new underlying implementation called
SRE written by Fredrik Lundh of Secret Labs AB. 

<P>
A <code>-U</code> command line option was added which causes the Python
compiler to interpret all string literals as Unicode string literals.
This is intended to be used in testing and future-proofing your Python
code, since some future version of Python may drop support for 8-bit
strings and provide only Unicode strings.

<P>

<H1><A NAME="SECTION000600000000000000000">
5 List Comprehensions</A>
</H1>

<P>
Lists are a workhorse data type in Python, and many programs
manipulate a list at some point.  Two common operations on lists are
to loop over them, and either pick out the elements that meet a
certain criterion, or apply some function to each element.  For
example, given a list of strings, you might want to pull out all the
strings containing a given substring, or strip off trailing whitespace
from each line.  

<P>
The existing <tt class="function">map()</tt> and <tt class="function">filter()</tt> functions can be
used for this purpose, but they require a function as one of their
arguments.  This is fine if there's an existing built-in function that
can be passed directly, but if there isn't, you have to create a
little function to do the required work, and Python's scoping rules
make the result ugly if the little function needs additional
information.  Take the first example in the previous paragraph,
finding all the strings in the list containing a given substring.  You
could write the following to do it:

<P>
<dl><dd><pre class="verbatim">
# Given the list L, make a list of all strings 
# containing the substring S.
sublist = filter( lambda s, substring=S: 
                     string.find(s, substring) != -1,
	          L)
</pre></dl>

<P>
Because of Python's scoping rules, a default argument is used so that
the anonymous function created by the <tt class="keyword">lambda</tt> statement knows
what substring is being searched for.  List comprehensions make this
cleaner:

<P>
<dl><dd><pre class="verbatim">
sublist = [ s for s in L if string.find(s, S) != -1 ]
</pre></dl>

<P>
List comprehensions have the form:

<P>
<dl><dd><pre class="verbatim">
[ expression for expr in sequence1 
             for expr2 in sequence2 ...
	     for exprN in sequenceN
             if condition
</pre></dl>

<P>
The <tt class="keyword">for</tt>...<tt class="keyword">in</tt> clauses contain the sequences to be
iterated over.  The sequences do not have to be the same length,
because they are <i>not</i> iterated over in parallel, but
from left to right; this is explained more clearly in the following
paragraphs.  The elements of the generated list will be the successive
values of <var>expression</var>.  The final <tt class="keyword">if</tt> clause is
optional; if present, <var>expression</var> is only evaluated and added to
the result if <var>condition</var> is true.

<P>
To make the semantics very clear, a list comprehension is equivalent
to the following Python code:

<P>
<dl><dd><pre class="verbatim">
for expr1 in sequence1:
    for expr2 in sequence2:
    ...
        for exprN in sequenceN:
             if (condition):
                  # Append the value of 
                  # the expression to the 
                  # resulting list.
</pre></dl>

<P>
This means that when there are <tt class="keyword">for</tt>...<tt class="keyword">in</tt> clauses,
the resulting list will be equal to the product of the lengths of all
the sequences.  If you have two lists of length 3, the output list is
9 elements long:

<P>
<dl><dd><pre class="verbatim">
seq1 = 'abc'
seq2 = (1,2,3)
&gt;&gt;&gt; [ (x,y) for x in seq1 for y in seq2]
[('a', 1), ('a', 2), ('a', 3), ('b', 1), ('b', 2), ('b', 3), ('c', 1),
('c', 2), ('c', 3)]
</pre></dl>

<P>
To avoid introducing an ambiguity into Python's grammar, if
<var>expression</var> is creating a tuple, it must be surrounded with
parentheses.  The first list comprehension below is a syntax error,
while the second one is correct:

<P>
<dl><dd><pre class="verbatim">
# Syntax error
[ x,y for x in seq1 for y in seq2]
# Correct
[ (x,y) for x in seq1 for y in seq2]
</pre></dl>

<P>
The idea of list comprehensions originally comes from the functional
programming language Haskell (<a class="url" href="http://www.haskell.org">http://www.haskell.org</a>).  Greg
Ewing argued most effectively for adding them to Python and wrote the
initial list comprehension patch, which was then discussed for a
seemingly endless time on the python-dev mailing list and kept
up-to-date by Skip Montanaro.

<P>

<H1><A NAME="SECTION000700000000000000000">
6 Augmented Assignment</A>
</H1>

<P>
Augmented assignment operators, another long-requested feature, have
been added to Python 2.0.  Augmented assignment operators include
<code>+=</code>, <code>-=</code>, <code>*=</code>, and so forth.  For example, the
statement <code>a += 2</code> increments the value of the variable 
<code>a</code> by 2, equivalent to the slightly lengthier <code>a = a + 2</code>.

<P>
The full list of supported assignment operators is <code>+=</code>,
<code>-=</code>, <code>*=</code>, <code>/=</code>, <code>%=</code>, <code>**=</code>, <code>&amp;=</code>,
<code>|=</code>, <code>^=</code>, <code>&#187;=</code>, and <code>&#171;=</code>.  Python classes can
override the augmented assignment operators by defining methods named
<tt class="method">__iadd__</tt>, <tt class="method">__isub__</tt>, etc.  For example, the following
<tt class="class">Number</tt> class stores a number and supports using += to create a
new instance with an incremented value.

<P>
<dl><dd><pre class="verbatim">
class Number:
    def __init__(self, value):
        self.value = value
    def __iadd__(self, increment):
	return Number( self.value + increment)

n = Number(5)
n += 3
print n.value
</pre></dl>

<P>
The <tt class="method">__iadd__</tt> special method is called with the value of the
increment, and should return a new instance with an appropriately
modified value; this return value is bound as the new value of the
variable on the left-hand side. 

<P>
Augmented assignment operators were first introduced in the C
programming language, and most C-derived languages, such as
<b class="program">awk</b>, C++, Java, Perl, and PHP also support them.  The augmented
assignment patch was implemented by Thomas Wouters.

<P>

<H1><A NAME="SECTION000800000000000000000">
7 String Methods</A>
</H1>

<P>
Until now string-manipulation functionality was in the <tt class="module">string</tt>
module, which was usually a front-end for the <tt class="module">strop</tt>
module written in C.  The addition of Unicode posed a difficulty for
the <tt class="module">strop</tt> module, because the functions would all need to be
rewritten in order to accept either 8-bit or Unicode strings.  For
functions such as <tt class="function">string.replace()</tt>, which takes 3 string
arguments, that means eight possible permutations, and correspondingly
complicated code.

<P>
Instead, Python 2.0 pushes the problem onto the string type, making
string manipulation functionality available through methods on both
8-bit strings and Unicode strings.  

<P>
<dl><dd><pre class="verbatim">
&gt;&gt;&gt; 'andrew'.capitalize()
'Andrew'
&gt;&gt;&gt; 'hostname'.replace('os', 'linux')
'hlinuxtname'
&gt;&gt;&gt; 'moshe'.find('sh')
2
</pre></dl>

<P>
One thing that hasn't changed, a noteworthy April Fools' joke
notwithstanding, is that Python strings are immutable. Thus, the
string methods return new strings, and do not modify the string on
which they operate.

<P>
The old <tt class="module">string</tt> module is still around for backwards
compatibility, but it mostly acts as a front-end to the new string
methods.

<P>
Two methods which have no parallel in pre-2.0 versions, although they
did exist in JPython for quite some time, are <tt class="method">startswith()</tt>
and <tt class="method">endswith</tt>.  <code>s.startswith(t)</code> is equivalent to <code>s[:len(t)]
== t</code>, while <code>s.endswith(t)</code> is equivalent to <code>s[-len(t):] == t</code>.

<P>
One other method which deserves special mention is <tt class="method">join</tt>.  The
<tt class="method">join</tt> method of a string receives one parameter, a sequence of
strings, and is equivalent to the <tt class="function">string.join</tt> function from
the old <tt class="module">string</tt> module, with the arguments reversed. In other
words, <code>s.join(seq)</code> is equivalent to the old
<code>string.join(seq, s)</code>.

<P>

<H1><A NAME="SECTION000900000000000000000">
8 Garbage Collection of Cycles</A>
</H1>

<P>
The C implementation of Python uses reference counting to implement
garbage collection.  Every Python object maintains a count of the
number of references pointing to itself, and adjusts the count as
references are created or destroyed.  Once the reference count reaches
zero, the object is no longer accessible, since you need to have a
reference to an object to access it, and if the count is zero, no
references exist any longer.  

<P>
Reference counting has some pleasant properties: it's easy to
understand and implement, and the resulting implementation is
portable, fairly fast, and reacts well with other libraries that
implement their own memory handling schemes.  The major problem with
reference counting is that it sometimes doesn't realise that objects
are no longer accessible, resulting in a memory leak.  This happens
when there are cycles of references.

<P>
Consider the simplest possible cycle, 
a class instance which has a reference to itself:

<P>
<dl><dd><pre class="verbatim">
instance = SomeClass()
instance.myself = instance
</pre></dl>

<P>
After the above two lines of code have been executed, the reference
count of <code>instance</code> is 2; one reference is from the variable
named "<tt class="samp">'instance'</tt>", and the other is from the "<tt class="samp">myself</tt>"attribute of the instance.  

<P>
If the next line of code is <code>del instance</code>, what happens?  The
reference count of <code>instance</code> is decreased by 1, so it has a
reference count of 1; the reference in the "<tt class="samp">myself</tt>" attribute
still exists.  Yet the instance is no longer accessible through Python
code, and it could be deleted.  Several objects can participate in a
cycle if they have references to each other, causing all of the
objects to be leaked.

<P>
Python 2.0 fixes this problem by periodically executing a cycle
detection algorithm which looks for inaccessible cycles and deletes
the objects involved.  A new <tt class="module">gc</tt> module provides functions to
perform a garbage collection, obtain debugging statistics, and tuning
the collector's parameters.

<P>
Running the cycle detection algorithm takes some time, and therefore
will result in some additional overhead.  It is hoped that after we've
gotten experience with the cycle collection from using 2.0, Python 2.1
will be able to minimize the overhead with careful tuning.  It's not
yet obvious how much performance is lost, because benchmarking this is
tricky and depends crucially on how often the program creates and
destroys objects.  The detection of cycles can be disabled when Python
is compiled, if you can't afford even a tiny speed penalty or suspect
that the cycle collection is buggy, by specifying the
"<tt class="samp">-without-cycle-gc</tt>" switch when running the <span class="file">configure</span>
script.

<P>
Several people tackled this problem and contributed to a solution.  An
early implementation of the cycle detection approach was written by
Toby Kelsey.  The current algorithm was suggested by Eric Tiedemann
during a visit to CNRI, and Guido van Rossum and Neil Schemenauer
wrote two different implementations, which were later integrated by
Neil.  Lots of other people offered suggestions along the way; the
March 2000 archives of the python-dev mailing list contain most of the
relevant discussion, especially in the threads titled ``Reference
cycle collection for Python'' and ``Finalization again''.

<P>

<H1><A NAME="SECTION0001000000000000000000">
9 Other Core Changes</A>
</H1>

<P>
Various minor changes have been made to Python's syntax and built-in
functions.  None of the changes are very far-reaching, but they're
handy conveniences.

<P>

<H2><A NAME="SECTION0001010000000000000000">
9.1 Minor Language Changes</A>
</H2>

<P>
A new syntax makes it more convenient to call a given function
with a tuple of arguments and/or a dictionary of keyword arguments.
In Python 1.5 and earlier, you'd use the <tt class="function">apply()</tt>
built-in function: <code>apply(f, <var>args</var>, <var>kw</var>)</code> calls the
function <tt class="function">f()</tt> with the argument tuple <var>args</var> and the
keyword arguments in the dictionary <var>kw</var>.  <tt class="function">apply()</tt> 
is the same in 2.0, but thanks to a patch from
Greg Ewing, <code>f(*<var>args</var>, **<var>kw</var>)</code> as a shorter
and clearer way to achieve the same effect.  This syntax is
symmetrical with the syntax for defining functions:

<P>
<dl><dd><pre class="verbatim">
def f(*args, **kw):
    # args is a tuple of positional args,
    # kw is a dictionary of keyword args
    ...
</pre></dl>

<P>
The <tt class="keyword">print</tt> statement can now have its output directed to a
file-like object by following the <tt class="keyword">print</tt> with 
<code>&gt;&gt; file</code>, similar to the redirection operator in Unix shells.
Previously you'd either have to use the <tt class="method">write()</tt> method of the
file-like object, which lacks the convenience and simplicity of
<tt class="keyword">print</tt>, or you could assign a new value to 
<code>sys.stdout</code> and then restore the old value.  For sending output to standard error,
it's much easier to write this:

<P>
<dl><dd><pre class="verbatim">
print &gt;&gt; sys.stderr, "Warning: action field not supplied"
</pre></dl>

<P>
Modules can now be renamed on importing them, using the syntax
<code>import <var>module</var> as <var>name</var></code> or <code>from <var>module</var>
import <var>name</var> as <var>othername</var></code>.  The patch was submitted by
Thomas Wouters.

<P>
A new format style is available when using the <code>%</code> operator;
'%r' will insert the <tt class="function">repr()</tt> of its argument.  This was
also added from symmetry considerations, this time for symmetry with
the existing '%s' format style, which inserts the <tt class="function">str()</tt> of
its argument.  For example, <code>'%r %s' % ('abc', 'abc')</code> returns a
string containing <code>'abc' abc</code>.

<P>
Previously there was no way to implement a class that overrode
Python's built-in <tt class="keyword">in</tt> operator and implemented a custom
version.  <code><var>obj</var> in <var>seq</var></code> returns true if <var>obj</var> is
present in the sequence <var>seq</var>; Python computes this by simply
trying every index of the sequence until either <var>obj</var> is found or
an <tt class="exception">IndexError</tt> is encountered.  Moshe Zadka contributed a
patch which adds a <tt class="method">__contains__</tt> magic method for providing a
custom implementation for <tt class="keyword">in</tt>. Additionally, new built-in
objects written in C can define what <tt class="keyword">in</tt> means for them via a
new slot in the sequence protocol.

<P>
Earlier versions of Python used a recursive algorithm for deleting
objects.  Deeply nested data structures could cause the interpreter to
fill up the C stack and crash; Christian Tismer rewrote the deletion
logic to fix this problem.  On a related note, comparing recursive
objects recursed infinitely and crashed; Jeremy Hylton rewrote the
code to no longer crash, producing a useful result instead.  For
example, after this code:

<P>
<dl><dd><pre class="verbatim">
a = []
b = []
a.append(a)
b.append(b)
</pre></dl>

<P>
The comparison <code>a==b</code> returns true, because the two recursive
data structures are isomorphic. See the thread ``trashcan
and PR#7'' in the April 2000 archives of the python-dev mailing list
for the discussion leading up to this implementation, and some useful
relevant links.  

<P>
Note that comparisons can now also raise exceptions. In earlier
versions of Python, a comparison operation such as <code>cmp(a,b)</code>
would always produce an answer, even if a user-defined
<tt class="method">__cmp__</tt> method encountered an error, since the resulting
exception would simply be silently swallowed.

<P>
Work has been done on porting Python to 64-bit Windows on the Itanium
processor, mostly by Trent Mick of ActiveState.  (Confusingly,
<code>sys.platform</code> is still <code>'win32'</code> on Win64 because it seems
that for ease of porting, MS Visual C++ treats code as 32 bit on Itanium.)
PythonWin also supports Windows CE; see the Python CE page at
<a class="url" href="http://starship.python.net/crew/mhammond/ce/">http://starship.python.net/crew/mhammond/ce/</a> for more
information.

<P>
Another new platform is Darwin/MacOS X; inital support for it is in
Python 2.0.  Dynamic loading works, if you specify ``configure
-with-dyld -with-suffix=.x''.  Consult the README in the Python
source distribution for more instructions.

<P>
An attempt has been made to alleviate one of Python's warts, the
often-confusing <tt class="exception">NameError</tt> exception when code refers to a
local variable before the variable has been assigned a value.  For
example, the following code raises an exception on the <tt class="keyword">print</tt>
statement in both 1.5.2 and 2.0; in 1.5.2 a <tt class="exception">NameError</tt>
exception is raised, while 2.0 raises a new
<tt class="exception">UnboundLocalError</tt> exception.
<tt class="exception">UnboundLocalError</tt> is a subclass of <tt class="exception">NameError</tt>,
so any existing code that expects <tt class="exception">NameError</tt> to be raised
should still work.

<P>
<dl><dd><pre class="verbatim">
def f():
    print "i=",i
    i = i + 1 
f()
</pre></dl>

<P>
Two new exceptions, <tt class="exception">TabError</tt> and
<tt class="exception">IndentationError</tt>, have been introduced.  They're both
subclasses of <tt class="exception">SyntaxError</tt>, and are raised when Python code
is found to be improperly indented.

<P>

<H2><A NAME="SECTION0001020000000000000000">
9.2 Changes to Built-in Functions</A>
</H2>

<P>
A new built-in, <tt class="function">zip(<var>seq1</var>, <var>seq2</var>, ...)</tt>, has been
added.  <tt class="function">zip()</tt> returns a list of tuples where each tuple
contains the i-th element from each of the argument sequences.  The
difference between <tt class="function">zip()</tt> and <code>map(None, <var>seq1</var>,
<var>seq2</var>)</code> is that <tt class="function">map()</tt> pads the sequences with
<code>None</code> if the sequences aren't all of the same length, while
<tt class="function">zip()</tt> truncates the returned list to the length of the
shortest argument sequence.

<P>
The <tt class="function">int()</tt> and <tt class="function">long()</tt> functions now accept an
optional ``base'' parameter when the first argument is a string.
<code>int('123', 10)</code> returns 123, while <code>int('123', 16)</code> returns
291.  <code>int(123, 16)</code> raises a <tt class="exception">TypeError</tt> exception
with the message ``can't convert non-string with explicit base''.

<P>
A new variable holding more detailed version information has been
added to the <tt class="module">sys</tt> module.  <code>sys.version_info</code> is a tuple
<code>(<var>major</var>, <var>minor</var>, <var>micro</var>, <var>level</var>,
<var>serial</var>)</code> For example, in a hypothetical 2.0.1beta1,
<code>sys.version_info</code> would be <code>(2, 0, 1, 'beta', 1)</code>.
<var>level</var> is a string such as <code>"alpha"</code>, <code>"beta"</code>, or
<code>"final"</code> for a final release.

<P>
Dictionaries have an odd new method, <tt class="method">setdefault(<var>key</var>,
<var>default</var>)</tt>, which behaves similarly to the existing
<tt class="method">get()</tt> method.  However, if the key is missing,
<tt class="method">setdefault()</tt> both returns the value of <var>default</var> as
<tt class="method">get()</tt> would do, and also inserts it into the dictionary as
the value for <var>key</var>.  Thus, the following lines of code:

<P>
<dl><dd><pre class="verbatim">
if dict.has_key( key ): return dict[key]
else: 
    dict[key] = []
    return dict[key]
</pre></dl>

<P>
can be reduced to a single <code>return dict.setdefault(key, [])</code> statement.

<P>
The interpreter sets a maximum recursion depth in order to catch
runaway recursion before filling the C stack and causing a core dump
or GPF..  Previously this limit was fixed when you compiled Python,
but in 2.0 the maximum recursion depth can be read and modified using
<tt class="function">sys.getrecursionlimit</tt> and <tt class="function">sys.setrecursionlimit</tt>.
The default value is 1000, and a rough maximum value for a given
platform can be found by running a new script,
<span class="file">Misc/find_recursionlimit.py</span>.

<P>

<H1><A NAME="SECTION0001100000000000000000">
10 Porting to 2.0</A>
</H1>

<P>
New Python releases try hard to be compatible with previous releases,
and the record has been pretty good.  However, some changes are
considered useful enough, usually because they fix initial design decisions that
turned out to be actively mistaken, that breaking backward compatibility
can't always be avoided.  This section lists the changes in Python 2.0
that may cause old Python code to break.

<P>
The change which will probably break the most code is tightening up
the arguments accepted by some methods.  Some methods would take
multiple arguments and treat them as a tuple, particularly various
list methods such as <tt class="method">.append()</tt> and <tt class="method">.insert()</tt>.
In earlier versions of Python, if <code>L</code> is a list, <code>L.append(
1,2 )</code> appends the tuple <code>(1,2)</code> to the list.  In Python 2.0 this
causes a <tt class="exception">TypeError</tt> exception to be raised, with the
message: 'append requires exactly 1 argument; 2 given'.  The fix is to
simply add an extra set of parentheses to pass both values as a tuple: 
<code>L.append( (1,2) )</code>.

<P>
The earlier versions of these methods were more forgiving because they
used an old function in Python's C interface to parse their arguments;
2.0 modernizes them to use <tt class="function">PyArg_ParseTuple</tt>, the current
argument parsing function, which provides more helpful error messages
and treats multi-argument calls as errors.  If you absolutely must use
2.0 but can't fix your code, you can edit <span class="file">Objects/listobject.c</span>
and define the preprocessor symbol <code>NO_STRICT_LIST_APPEND</code> to
preserve the old behaviour; this isn't recommended.

<P>
Some of the functions in the <tt class="module">socket</tt> module are still
forgiving in this way.  For example, <tt class="function">socket.connect(
('hostname', 25) )</tt> is the correct form, passing a tuple representing
an IP address, but <tt class="function">socket.connect( 'hostname', 25 )</tt> also
works. <tt class="function">socket.connect_ex()</tt> and <tt class="function">socket.bind()</tt> are
similarly easy-going.  2.0alpha1 tightened these functions up, but
because the documentation actually used the erroneous multiple
argument form, many people wrote code which would break with the
stricter checking.  GvR backed out the changes in the face of public
reaction, so for the <tt class="module">socket</tt> module, the documentation was
fixed and the multiple argument form is simply marked as deprecated;
it <i>will</i> be tightened up again in a future Python version.

<P>
The <code>&#92;x</code> escape in string literals now takes exactly 2 hex
digits.  Previously it would consume all the hex digits following the
'x' and take the lowest 8 bits of the result, so <code>&#92;x123456</code> was
equivalent to <code>&#92;x56</code>.

<P>
The <tt class="exception">AttributeError</tt> exception has a more friendly error message,
whose text will be something like <code>'Spam' instance has no attribute 'eggs'</code>.
Previously the error message was just the missing attribute name <code>eggs</code>, and 
code written to take advantage of this fact will break in 2.0.

<P>
Some work has been done to make integers and long integers a bit more
interchangeable.  In 1.5.2, large-file support was added for Solaris,
to allow reading files larger than 2Gb; this made the <tt class="method">tell()</tt>
method of file objects return a long integer instead of a regular
integer.  Some code would subtract two file offsets and attempt to use
the result to multiply a sequence or slice a string, but this raised a
<tt class="exception">TypeError</tt>.  In 2.0, long integers can be used to multiply
or slice a sequence, and it'll behave as you'd intuitively expect it
to; <code>3L * 'abc'</code> produces 'abcabcabc', and <code>
(0,1,2,3)[2L:4L]</code> produces (2,3). Long integers can also be used in
various contexts where previously only integers were accepted, such
as in the <tt class="method">seek()</tt> method of file objects, and in the formats
supported by the <code>%</code> operator (<code>%d</code>, <code>%i</code>, <code>%x</code>,
etc.).  For example, <code>"%d" % 2L**64</code> will produce the string
"<tt class="samp">18446744073709551616</tt>".

<P>
The subtlest long integer change of all is that the <tt class="function">str()</tt>
of a long integer no longer has a trailing 'L' character, though
<tt class="function">repr()</tt> still includes it.  The 'L' annoyed many people who
wanted to print long integers that looked just like regular integers,
since they had to go out of their way to chop off the character.  This
is no longer a problem in 2.0, but code which does <code>str(longval)[:-1]</code> and assumes the 'L' is there, will now lose
the final digit.

<P>
Taking the <tt class="function">repr()</tt> of a float now uses a different
formatting precision than <tt class="function">str()</tt>.  <tt class="function">repr()</tt> uses
<code>%.17g</code> format string for C's <tt class="function">sprintf()</tt>, while
<tt class="function">str()</tt> uses <code>%.12g</code> as before.  The effect is that 
<tt class="function">repr()</tt> may occasionally show more decimal places than 
<tt class="function">str()</tt>, for certain numbers. 
For example, the number 8.1 can't be represented exactly in binary, so
<code>repr(8.1)</code> is <code>'8.0999999999999996'</code>, while str(8.1) is
<code>'8.1'</code>.

<P>
The <code>-X</code> command-line option, which turned all standard
exceptions into strings instead of classes, has been removed; the
standard exceptions will now always be classes.  The
<tt class="module">exceptions</tt> module containing the standard exceptions was
translated from Python to a built-in C module, written by Barry Warsaw
and Fredrik Lundh.

<P>

<H1><A NAME="SECTION0001200000000000000000">
11 Extending/Embedding Changes</A>
</H1>

<P>
Some of the changes are under the covers, and will only be apparent to
people writing C extension modules or embedding a Python interpreter
in a larger application.  If you aren't dealing with Python's C API,
you can safely skip this section.

<P>
The version number of the Python C API was incremented, so C
extensions compiled for 1.5.2 must be recompiled in order to work with
2.0.  On Windows, it's not possible for Python 2.0 to import a third
party extension built for Python 1.5.x due to how Windows DLLs work,
so Python will raise an exception and the import will fail.

<P>
Users of Jim Fulton's ExtensionClass module will be pleased to find
out that hooks have been added so that ExtensionClasses are now
supported by <tt class="function">isinstance()</tt> and <tt class="function">issubclass()</tt>.
This means you no longer have to remember to write code such as
<code>if type(obj) == myExtensionClass</code>, but can use the more natural
<code>if isinstance(obj, myExtensionClass)</code>.

<P>
The <span class="file">Python/importdl.c</span> file, which was a mass of #ifdefs to
support dynamic loading on many different platforms, was cleaned up
and reorganised by Greg Stein.  <span class="file">importdl.c</span> is now quite small,
and platform-specific code has been moved into a bunch of
<span class="file">Python/dynload_*.c</span> files.  Another cleanup: there were also a
number of <span class="file">my*.h</span> files in the Include/ directory that held
various portability hacks; they've been merged into a single file,
<span class="file">Include/pyport.h</span>.

<P>
Vladimir Marangozov's long-awaited malloc restructuring was completed,
to make it easy to have the Python interpreter use a custom allocator
instead of C's standard <tt class="function">malloc()</tt>.  For documentation, read
the comments in <span class="file">Include/pymem.h</span> and
<span class="file">Include/objimpl.h</span>.  For the lengthy discussions during which
the interface was hammered out, see the Web archives of the 'patches'
and 'python-dev' lists at python.org.

<P>
Recent versions of the GUSI development environment for MacOS support
POSIX threads.  Therefore, Python's POSIX threading support now works
on the Macintosh.  Threading support using the user-space GNU <TT>pth</TT>
library was also contributed.

<P>
Threading support on Windows was enhanced, too.  Windows supports
thread locks that use kernel objects only in case of contention; in
the common case when there's no contention, they use simpler functions
which are an order of magnitude faster.  A threaded version of Python
1.5.2 on NT is twice as slow as an unthreaded version; with the 2.0
changes, the difference is only 10%.  These improvements were
contributed by Yakov Markovitch.

<P>
Python 2.0's source now uses only ANSI C prototypes, so compiling Python now
requires an ANSI C compiler, and can no longer be done using a compiler that
only supports K&amp;R C.  

<P>
Previously the Python virtual machine used 16-bit numbers in its
bytecode, limiting the size of source files.  In particular, this
affected the maximum size of literal lists and dictionaries in Python
source; occasionally people who are generating Python code would run
into this limit.  A patch by Charles G. Waldman raises the limit from
<code>2^16</code> to <code>2^{32}</code>.

<P>
Three new convenience functions intended for adding constants to a
module's dictionary at module initialization time were added:
<tt class="function">PyModule_AddObject()</tt>, <tt class="function">PyModule_AddIntConstant()</tt>,
and <tt class="function">PyModule_AddStringConstant()</tt>.  Each of these functions
takes a module object, a null-terminated C string containing the name
to be added, and a third argument for the value to be assigned to the
name.  This third argument is, respectively, a Python object, a C
long, or a C string.

<P>
A wrapper API was added for Unix-style signal handlers.
<tt class="function">PyOS_getsig()</tt> gets a signal handler and
<tt class="function">PyOS_setsig()</tt> will set a new handler.

<P>

<H1><A NAME="SECTION0001300000000000000000">
12 Distutils: Making Modules Easy to Install</A>
</H1>

<P>
Before Python 2.0, installing modules was a tedious affair - there
was no way to figure out automatically where Python is installed, or
what compiler options to use for extension modules.  Software authors
had to go through an arduous ritual of editing Makefiles and
configuration files, which only really work on Unix and leave Windows
and MacOS unsupported.  Python users faced wildly differing
installation instructions which varied between different extension
packages, which made adminstering a Python installation something of a
chore.

<P>
The SIG for distribution utilities, shepherded by Greg Ward, has
created the Distutils, a system to make package installation much
easier.  They form the <tt class="module">distutils</tt> package, a new part of
Python's standard library. In the best case, installing a Python
module from source will require the same steps: first you simply mean
unpack the tarball or zip archive, and the run ``<code>python setup.py
install</code>''.  The platform will be automatically detected, the compiler
will be recognized, C extension modules will be compiled, and the
distribution installed into the proper directory.  Optional
command-line arguments provide more control over the installation
process, the distutils package offers many places to override defaults
- separating the build from the install, building or installing in
non-default directories, and more.

<P>
In order to use the Distutils, you need to write a <span class="file">setup.py</span>
script.  For the simple case, when the software contains only .py
files, a minimal <span class="file">setup.py</span> can be just a few lines long:

<P>
<dl><dd><pre class="verbatim">
from distutils.core import setup
setup (name = "foo", version = "1.0", 
       py_modules = ["module1", "module2"])
</pre></dl>

<P>
The <span class="file">setup.py</span> file isn't much more complicated if the software
consists of a few packages:

<P>
<dl><dd><pre class="verbatim">
from distutils.core import setup
setup (name = "foo", version = "1.0", 
       packages = ["package", "package.subpackage"])
</pre></dl>

<P>
A C extension can be the most complicated case; here's an example taken from 
the PyXML package:

<P>
<dl><dd><pre class="verbatim">
from distutils.core import setup, Extension

expat_extension = Extension('xml.parsers.pyexpat',
	define_macros = [('XML_NS', None)],
	include_dirs = [ 'extensions/expat/xmltok',
	                 'extensions/expat/xmlparse' ],
	sources = [ 'extensions/pyexpat.c',
	            'extensions/expat/xmltok/xmltok.c',
 		    'extensions/expat/xmltok/xmlrole.c',
                  ]
       )
setup (name = "PyXML", version = "0.5.4", 
       ext_modules =[ expat_extension ] )
</pre></dl>

<P>
The Distutils can also take care of creating source and binary
distributions.  The ``sdist'' command, run by ``<code>python setup.py
sdist</code>', builds a source distribution such as <span class="file">foo-1.0.tar.gz</span>.
Adding new commands isn't difficult, ``bdist_rpm'' and
``bdist_wininst'' commands have already been contributed to create an
RPM distribution and a Windows installer for the software,
respectively.  Commands to create other distribution formats such as
Debian packages and Solaris <span class="file">.pkg</span> files are in various stages of
development.

<P>
All this is documented in a new manual, <i>Distributing Python
Modules</i>, that joins the basic set of Python documentation.

<P>

<H1><A NAME="SECTION0001400000000000000000">
13 XML Modules</A>
</H1>

<P>
Python 1.5.2 included a simple XML parser in the form of the
<tt class="module">xmllib</tt> module, contributed by Sjoerd Mullender.  Since
1.5.2's release, two different interfaces for processing XML have
become common: SAX2 (version 2 of the Simple API for XML) provides an
event-driven interface with some similarities to <tt class="module">xmllib</tt>, and
the DOM (Document Object Model) provides a tree-based interface,
transforming an XML document into a tree of nodes that can be
traversed and modified.  Python 2.0 includes a SAX2 interface and a
stripped-down DOM interface as part of the <tt class="module">xml</tt> package.
Here we will give a brief overview of these new interfaces; consult
the Python documentation or the source code for complete details.
The Python XML SIG is also working on improved documentation.

<P>

<H2><A NAME="SECTION0001410000000000000000">
13.1 SAX2 Support</A>
</H2>

<P>
SAX defines an event-driven interface for parsing XML.  To use SAX,
you must write a SAX handler class.  Handler classes inherit from
various classes provided by SAX, and override various methods that
will then be called by the XML parser.  For example, the
<tt class="method">startElement</tt> and <tt class="method">endElement</tt> methods are called for
every starting and end tag encountered by the parser, the
<tt class="method">characters()</tt> method is called for every chunk of character
data, and so forth.

<P>
The advantage of the event-driven approach is that that the whole
document doesn't have to be resident in memory at any one time, which
matters if you are processing really huge documents.  However, writing
the SAX handler class can get very complicated if you're trying to
modify the document structure in some elaborate way.

<P>
For example, this little example program defines a handler that prints
a message for every starting and ending tag, and then parses the file
<span class="file">hamlet.xml</span> using it:

<P>
<dl><dd><pre class="verbatim">
from xml import sax

class SimpleHandler(sax.ContentHandler):
    def startElement(self, name, attrs):
        print 'Start of element:', name, attrs.keys()

    def endElement(self, name):
        print 'End of element:', name

# Create a parser object
parser = sax.make_parser()

# Tell it what handler to use
handler = SimpleHandler()
parser.setContentHandler( handler )

# Parse a file!
parser.parse( 'hamlet.xml' )
</pre></dl>

<P>
For more information, consult the Python documentation, or the XML
HOWTO at <a class="url" href="http://www.python.org/doc/howto/xml/">http://www.python.org/doc/howto/xml/</a>.

<P>

<H2><A NAME="SECTION0001420000000000000000">
13.2 DOM Support</A>
</H2>

<P>
The Document Object Model is a tree-based representation for an XML
document.  A top-level <tt class="class">Document</tt> instance is the root of the
tree, and has a single child which is the top-level <tt class="class">Element</tt>
instance. This <tt class="class">Element</tt> has children nodes representing
character data and any sub-elements, which may have further children
of their own, and so forth.  Using the DOM you can traverse the
resulting tree any way you like, access element and attribute values,
insert and delete nodes, and convert the tree back into XML.

<P>
The DOM is useful for modifying XML documents, because you can create
a DOM tree, modify it by adding new nodes or rearranging subtrees, and
then produce a new XML document as output.  You can also construct a
DOM tree manually and convert it to XML, which can be a more flexible
way of producing XML output than simply writing
<code>&lt;tag1&gt;</code>...<code>&lt;/tag1&gt;</code> to a file.

<P>
The DOM implementation included with Python lives in the
<tt class="module">xml.dom.minidom</tt> module.  It's a lightweight implementation of
the Level 1 DOM with support for XML namespaces.  The 
<tt class="function">parse()</tt> and <tt class="function">parseString()</tt> convenience
functions are provided for generating a DOM tree:

<P>
<dl><dd><pre class="verbatim">
from xml.dom import minidom
doc = minidom.parse('hamlet.xml')
</pre></dl>

<P>
<code>doc</code> is a <tt class="class">Document</tt> instance.  <tt class="class">Document</tt>, like all
the other DOM classes such as <tt class="class">Element</tt> and <tt class="class">Text</tt>, is a
subclass of the <tt class="class">Node</tt> base class.  All the nodes in a DOM tree
therefore support certain common methods, such as <tt class="method">toxml()</tt>
which returns a string containing the XML representation of the node
and its children.  Each class also has special methods of its own; for
example, <tt class="class">Element</tt> and <tt class="class">Document</tt> instances have a method
to find all child elements with a given tag name.  Continuing from the
previous 2-line example:

<P>
<dl><dd><pre class="verbatim">
perslist = doc.getElementsByTagName( 'PERSONA' )
print perslist[0].toxml()
print perslist[1].toxml()
</pre></dl>

<P>
For the <i>Hamlet</i> XML file, the above few lines output:

<P>
<dl><dd><pre class="verbatim">
&lt;PERSONA&gt;CLAUDIUS, king of Denmark. &lt;/PERSONA&gt;
&lt;PERSONA&gt;HAMLET, son to the late, and nephew to the present king.&lt;/PERSONA&gt;
</pre></dl>

<P>
The root element of the document is available as
<code>doc.documentElement</code>, and its children can be easily modified
by deleting, adding, or removing nodes:

<P>
<dl><dd><pre class="verbatim">
root = doc.documentElement

# Remove the first child
root.removeChild( root.childNodes[0] )

# Move the new first child to the end
root.appendChild( root.childNodes[0] )

# Insert the new first child (originally,
# the third child) before the 20th child.
root.insertBefore( root.childNodes[0], root.childNodes[20] )
</pre></dl>

<P>
Again, I will refer you to the Python documentation for a complete
listing of the different <tt class="class">Node</tt> classes and their various methods.

<P>

<H2><A NAME="SECTION0001430000000000000000">
13.3 Relationship to PyXML</A>
</H2>

<P>
The XML Special Interest Group has been working on XML-related Python
code for a while.  Its code distribution, called PyXML, is available
from the SIG's Web pages at <a class="url" href="http://www.python.org/sigs/xml-sig/">http://www.python.org/sigs/xml-sig/</a>.
The PyXML distribution also used the package name "<tt class="samp">xml</tt>".  If
you've written programs that used PyXML, you're probably wondering
about its compatibility with the 2.0 <tt class="module">xml</tt> package.

<P>
The answer is that Python 2.0's <tt class="module">xml</tt> package isn't compatible
with PyXML, but can be made compatible by installing a recent version
PyXML.  Many applications can get by with the XML support that is
included with Python 2.0, but more complicated applications will
require that the full PyXML package will be installed.  When
installed, PyXML versions 0.6.0 or greater will replace the
<tt class="module">xml</tt> package shipped with Python, and will be a strict
superset of the standard package, adding a bunch of additional
features.  Some of the additional features in PyXML include:

<P>

<UL>
<LI>4DOM, a full DOM implementation
from FourThought, Inc.
</LI>
<LI>The xmlproc validating parser, written by Lars Marius Garshol.
</LI>
<LI>The <tt class="module">sgmlop</tt> parser accelerator module, written by Fredrik Lundh.
</LI>
</UL>

<P>

<H1><A NAME="SECTION0001500000000000000000">
14 Module changes</A>
</H1>

<P>
Lots of improvements and bugfixes were made to Python's extensive
standard library; some of the affected modules include
<tt class="module">readline</tt>, <tt class="module">ConfigParser</tt>, <tt class="module">cgi</tt>,
<tt class="module">calendar</tt>, <tt class="module">posix</tt>, <tt class="module">readline</tt>, <tt class="module">xmllib</tt>,
<tt class="module">aifc</tt>, <tt class="module">chunk, wave</tt>, <tt class="module">random</tt>, <tt class="module">shelve</tt>,
and <tt class="module">nntplib</tt>.  Consult the CVS logs for the exact
patch-by-patch details.  

<P>
Brian Gallew contributed OpenSSL support for the <tt class="module">socket</tt>
module.  OpenSSL is an implementation of the Secure Socket Layer,
which encrypts the data being sent over a socket.  When compiling
Python, you can edit <span class="file">Modules/Setup</span> to include SSL support,
which adds an additional function to the <tt class="module">socket</tt> module:
<tt class="function">socket.ssl(<var>socket</var>, <var>keyfile</var>, <var>certfile</var>)</tt>,
which takes a socket object and returns an SSL socket.  The
<tt class="module">httplib</tt> and <tt class="module">urllib</tt> modules were also changed to
support ``https://'' URLs, though no one has implemented FTP or SMTP
over SSL.  

<P>
The <tt class="module">httplib</tt> module has been rewritten by Greg Stein to
support HTTP/1.1.  Backward compatibility with the 1.5 version of
<tt class="module">httplib</tt> is provided, though using HTTP/1.1 features such as
pipelining will require rewriting code to use a different set of
interfaces.

<P>
The <tt class="module">Tkinter</tt> module now supports Tcl/Tk version 8.1, 8.2, or
8.3, and support for the older 7.x versions has been dropped.  The
Tkinter module now supports displaying Unicode strings in Tk widgets.
Also, Fredrik Lundh contributed an optimization which makes operations
like <code>create_line</code> and <code>create_polygon</code> much faster,
especially when using lots of coordinates.

<P>
The <tt class="module">curses</tt> module has been greatly extended, starting from
Oliver Andrich's enhanced version, to provide many additional
functions from ncurses and SYSV curses, such as colour, alternative
character set support, pads, and mouse support.  This means the module
is no longer compatible with operating systems that only have BSD
curses, but there don't seem to be any currently maintained OSes that
fall into this category.

<P>
As mentioned in the earlier discussion of 2.0's Unicode support, the
underlying implementation of the regular expressions provided by the
<tt class="module">re</tt> module has been changed.  SRE, a new regular expression
engine written by Fredrik Lundh and partially funded by Hewlett
Packard, supports matching against both 8-bit strings and Unicode
strings.

<P>

<H1><A NAME="SECTION0001600000000000000000">
15 New modules</A>
</H1>

<P>
A number of new modules were added.  We'll simply list them with brief
descriptions; consult the 2.0 documentation for the details of a
particular module.

<P>

<UL>
<LI><tt class="module">atexit</tt>: 
For registering functions to be called before the Python interpreter exits.
Code that currently sets
<code>sys.exitfunc</code> directly should be changed to 
use the <tt class="module">atexit</tt> module instead, importing <tt class="module">atexit</tt>
and calling <tt class="function">atexit.register()</tt> with 
the function to be called on exit.
(Contributed by Skip Montanaro.)

<P>
</LI>
<LI><tt class="module">codecs</tt>, <tt class="module">encodings</tt>, <tt class="module">unicodedata</tt>:  Added as part of the new Unicode support. 

<P>
</LI>
<LI><tt class="module">filecmp</tt>: Supersedes the old <tt class="module">cmp</tt>, <tt class="module">cmpcache</tt> and
<tt class="module">dircmp</tt> modules, which have now become deprecated.
(Contributed by Gordon MacMillan and Moshe Zadka.)

<P>
</LI>
<LI><tt class="module">gettext</tt>: This module provides internationalization
(I18N) and localization (L10N) support for Python programs by
providing an interface to the GNU gettext message catalog library.
(Integrated by Barry Warsaw, from separate contributions by Martin von
Loewis, Peter Funk, and James Henstridge.)

<P>
</LI>
<LI><tt class="module">linuxaudiodev</tt>: Support for the <span class="file">/dev/audio</span>
device on Linux, a twin to the existing <tt class="module">sunaudiodev</tt> module.
(Contributed by Peter Bosch, with fixes by Jeremy Hylton.)

<P>
</LI>
<LI><tt class="module">mmap</tt>: An interface to memory-mapped files on both
Windows and Unix.  A file's contents can be mapped directly into
memory, at which point it behaves like a mutable string, so its
contents can be read and modified.  They can even be passed to
functions that expect ordinary strings, such as the <tt class="module">re</tt>
module. (Contributed by Sam Rushing, with some extensions by
A.M. Kuchling.)

<P>
</LI>
<LI><tt class="module">pyexpat</tt>: An interface to the Expat XML parser.
(Contributed by Paul Prescod.)

<P>
</LI>
<LI><tt class="module">robotparser</tt>: Parse a <span class="file">robots.txt</span> file, which is
used for writing Web spiders that politely avoid certain areas of a
Web site.  The parser accepts the contents of a <span class="file">robots.txt</span> file,
builds a set of rules from it, and can then answer questions about
the fetchability of a given URL.  (Contributed by Skip Montanaro.)

<P>
</LI>
<LI><tt class="module">tabnanny</tt>: A module/script to 
check Python source code for ambiguous indentation.
(Contributed by Tim Peters.)

<P>
</LI>
<LI><tt class="module">UserString</tt>: A base class useful for deriving objects that behave like strings.  

<P>
</LI>
<LI><tt class="module">webbrowser</tt>: A module that provides a platform independent
way to launch a web browser on a specific URL. For each platform, various
browsers are tried in a specific order. The user can alter which browser
is launched by setting the <var>BROWSER</var> environment variable. 
(Originally inspired by Eric S. Raymond's patch to <tt class="module">urllib</tt>
which added similar functionality, but
the final module comes from code originally 
implemented by Fred Drake as <span class="file">Tools/idle/BrowserControl.py</span>,
and adapted for the standard library by Fred.)

<P>
</LI>
<LI><tt class="module">_winreg</tt>: An interface to the
Windows registry.  <tt class="module">_winreg</tt> is an adaptation of functions that
have been part of PythonWin since 1995, but has now been added to the core 
distribution, and enhanced to support Unicode.  
<tt class="module">_winreg</tt> was written by Bill Tutt and Mark Hammond.

<P>
</LI>
<LI><tt class="module">zipfile</tt>: A module for reading and writing ZIP-format
archives.  These are archives produced by <b class="program">PKZIP</b> on
DOS/Windows or <b class="program">zip</b> on Unix, not to be confused with
<b class="program">gzip</b>-format files (which are supported by the <tt class="module">gzip</tt>
module)
(Contributed by James C. Ahlstrom.)

<P>
</LI>
<LI><tt class="module">imputil</tt>: A module that provides a simpler way for
writing customised import hooks, in comparison to the existing
<tt class="module">ihooks</tt> module.  (Implemented by Greg Stein, with much
discussion on python-dev along the way.)

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION0001700000000000000000">
16 IDLE Improvements</A>
</H1>

<P>
IDLE is the official Python cross-platform IDE, written using Tkinter.
Python 2.0 includes IDLE 0.6, which adds a number of new features and
improvements.  A partial list:

<P>

<UL>
<LI>UI improvements and optimizations,
especially in the area of syntax highlighting and auto-indentation.

<P>
</LI>
<LI>The class browser now shows more information, such as the top
level functions in a module.

<P>
</LI>
<LI>Tab width is now a user settable option. When opening an existing Python
file, IDLE automatically detects the indentation conventions, and adapts.

<P>
</LI>
<LI>There is now support for calling browsers on various platforms,
used to open the Python documentation in a browser.

<P>
</LI>
<LI>IDLE now has a command line, which is largely similar to 
the vanilla Python interpreter.

<P>
</LI>
<LI>Call tips were added in many places.

<P>
</LI>
<LI>IDLE can now be installed as a package.

<P>
</LI>
<LI>In the editor window, there is now a line/column bar at the bottom.

<P>
</LI>
<LI>Three new keystroke commands: Check module (Alt-F5), Import
module (F5) and Run script (Ctrl-F5).

<P>
</LI>
</UL>

<P>

<H1><A NAME="SECTION0001800000000000000000">
17 Deleted and Deprecated Modules</A>
</H1>

<P>
A few modules have been dropped because they're obsolete, or because
there are now better ways to do the same thing.  The <tt class="module">stdwin</tt>
module is gone; it was for a platform-independent windowing toolkit
that's no longer developed.  

<P>
A number of modules have been moved to the
<span class="file">lib-old</span> subdirectory:
<tt class="module">cmp</tt>, <tt class="module">cmpcache</tt>, <tt class="module">dircmp</tt>, <tt class="module">dump</tt>, 
<tt class="module">find</tt>, <tt class="module">grep</tt>, <tt class="module">packmail</tt>, 
<tt class="module">poly</tt>, <tt class="module">util</tt>, <tt class="module">whatsound</tt>, <tt class="module">zmod</tt>. 
If you have code which relies on a module  that's been moved to
<span class="file">lib-old</span>, you can simply add that directory to <code>sys.path</code>  
to get them back, but you're encouraged to update any code that uses
these modules.

<P>

<H1><A NAME="SECTION0001900000000000000000">
18 Acknowledgements</A>
</H1>

<P>
The authors would like to thank the following people for offering
suggestions on various drafts of this article: David Bolen, Mark Hammond, Gregg Hauser,
Jeremy Hylton, Fredrik Lundh, Detlef Lannert, Aahz Maruch, Skip
Montanaro, Vladimir Marangozov, Guido van Rossum, Neil Schemenauer,
and Russ Schmidt.

<P>

<H1><A NAME="SECTION0002000000000000000000">
About this document ...</A>
</H1>
 <strong>What's New in Python 2.0</strong>
<p> This document was generated using the <a
    href="http://saftsack.fs.uni-bayreuth.de/~latex2ht/">
    <strong>LaTeX</strong>2<tt>HTML</tt></a> translator.
</p>

<p> <a
    href="http://saftsack.fs.uni-bayreuth.de/~latex2ht/">
    <strong>LaTeX</strong>2<tt>HTML</tt></a> is Copyright &copy;
  1993, 1994, 1995, 1996, 1997, <a
    href="http://cbl.leeds.ac.uk/nikos/personal.html">Nikos
    Drakos</a>, Computer Based Learning Unit, University of
  Leeds, and Copyright &copy; 1997, 1998, <a
    href="http://www.maths.mq.edu.au/~ross/">Ross
    Moore</a>, Mathematics Department, Macquarie University,
  Sydney.
</p>

<p> The application of <a
    href="http://saftsack.fs.uni-bayreuth.de/~latex2ht/">
    <strong>LaTeX</strong>2<tt>HTML</tt></a> to the Python
  documentation has been heavily tailored by Fred L. Drake,
  Jr.  Original navigation icons were contributed by Christopher
  Petrilli.
</p>

<hr>
<span class="release-info">Release 1.01.</span>
<!--End of Navigation Panel-->

</BODY>
</HTML>
