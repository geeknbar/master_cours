<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/peps/pep-0001.html for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<head>
  <title>PEP 288 -- Generators Attributes and Exceptions</title>
  <link rel="STYLESHEET" href="style.css" type="text/css" />
</head>
<body bgcolor="white">

<div class="header">
<table border="0">
  <tr><th>PEP:&nbsp;</th><td>288</td></tr>
  <tr><th>Title:&nbsp;</th><td>Generators Attributes and Exceptions</td></tr>
  <tr><th>Version:&nbsp;</th><td>$Revision: 56113 $</td></tr>
  <tr><th>Last-Modified:&nbsp;</th><td><a href="http://svn.python.org/view/peps/trunk/pep-0288.txt">$Date: 2007-06-28 12:44:20 -0700 (Thu, 28 Jun 2007) $</a> </td></tr>
  <tr><th>Author:&nbsp;</th><td>Raymond Hettinger &lt;python&#32;&#97;t&#32;rcn.com&gt;</td></tr>
  <tr><th>Status:&nbsp;</th><td>Withdrawn</td></tr>
  <tr><th>Type:&nbsp;</th><td>Standards Track</td></tr>
  <tr><th>Created:&nbsp;</th><td>21-Mar-2002</td></tr>
  <tr><th>Python-Version:&nbsp;</th><td>2.5</td></tr>
  <tr><th>Post-History:&nbsp;</th><td></td></tr>
</table>
</div>
<hr />
<div class="content">
<h3>Abstract</h3>
<pre>
    This PEP proposes to enhance generators by providing mechanisms for
    raising exceptions and sharing data with running generators.


</pre>
<h3>Status</h3>
<pre>
    This PEP is withdrawn.  The exception raising mechanism was extended
    and subsumed into <a href="pep-0343.html">PEP 343</a>.  The attribute passing capability
    never built a following, did not have a clear implementation,
    and did not have a clean way for the running generator to access
    its own namespace.


</pre>
<h3>Rationale</h3>
<pre>
    Currently, only class based iterators can provide attributes and
    exception handling.  However, class based iterators are harder to
    write, less compact, less readable, and slower.  A better solution
    is to enable these capabilities for generators.

    Enabling attribute assignments allows data to be passed to and from
    running generators.  The approach of sharing data using attributes
    pervades Python.  Other approaches exist but are somewhat hackish
    in comparison.

    Another evolutionary step is to add a generator method to allow
    exceptions to be passed to a generator.  Currently, there is no
    clean method for triggering exceptions from outside the generator.
    Also, generator exception passing helps mitigate the try/finally
    prohibition for generators.  The need is especially acute for
    generators needing to flush buffers or close resources upon termination.
    
    The two proposals are backwards compatible and require no new
    keywords.  They are being recommended for Python version 2.5.



</pre>
<h3>Specification for Generator Attributes</h3>
<pre>
    Essentially, the proposal is to emulate attribute writing for classes.
    The only wrinkle is that generators lack a way to refer to instances of
    themselves.  So, the proposal is to provide a function for discovering
    the reference.  For example:

        def mygen(filename):
            self = sys.get_generator()
            myfile = open(filename)
            for line in myfile:
                if len(line) &lt; 10:
                    continue
                self.pos = myfile.tell()
                yield line.upper()

        g = mygen('sample.txt')
        line1 = g.next()
        print 'Position', g.pos

    Uses for generator attributes include:

        1. Providing generator clients with extra information (as shown
           above).
        2. Externally setting control flags governing generator operation
           (possibly telling a generator when to step in or step over
           data groups).
        3. Writing lazy consumers with complex execution states
           (an arithmetic encoder output stream for example).
        4. Writing co-routines (as demonstrated in Dr. Mertz's articles [1]).

    The control flow of 'yield' and 'next' is unchanged by this
    proposal.  The only change is that data can passed to and from the
    generator.  Most of the underlying machinery is already in place,
    only the access function needs to be added.



</pre>
<h3>Specification for Generator Exception Passing:</h3>
<pre>
    Add a .throw(exception) method to the generator interface:

        def logger():
            start = time.time()
            log = []
            try:
                while True:
                    log.append(time.time() - start)
                    yield log[-1]
            except WriteLog:
                writelog(log)

        g = logger()
        for i in [10,20,40,80,160]:
            testsuite(i)
            g.next()
        g.throw(WriteLog)

    There is no existing work-around for triggering an exception
    inside a generator.  It is the only case in Python where active
    code cannot be excepted to or through.

    Generator exception passing also helps address an intrinsic
    limitation on generators, the prohibition against their using
    try/finally to trigger clean-up code [2].

    Note A: The name of the throw method was selected for several
    reasons.  Raise is a keyword and so cannot be used as a method
    name.  Unlike raise which immediately raises an exception from the
    current execution point, throw will first return to the generator
    and then raise the exception.  The word throw is suggestive of
    putting the exception in another location.  The word throw is
    already associated with exceptions in other languages.

    Alternative method names were considered: resolve(), signal(),
    genraise(), raiseinto(), and flush().  None of these fit as well
    as throw().

    Note B:  To keep the throw() syntax simple only the instance
    version of the raise syntax would be supported (no variants for
    "raise string" or "raise class, instance").

    Calling "g.throw(instance)" would correspond to writing
    "raise instance" immediately after the most recent yield.



</pre>
<h3>References</h3>
<pre>
    [1] Dr. David Mertz's draft columns for Charming Python:
        <a href="http://gnosis.cx/publish/programming/charming_python_b5.txt">http://gnosis.cx/publish/programming/charming_python_b5.txt</a>
        <a href="http://gnosis.cx/publish/programming/charming_python_b7.txt">http://gnosis.cx/publish/programming/charming_python_b7.txt</a>

    [2] <a href="pep-0255.html">PEP 255</a> Simple Generators:
        <a href="http://www.python.org/peps/pep-0255.html">http://www.python.org/peps/pep-0255.html</a>

    [3] Proof-of-concept recipe:
        <a href="http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/164044">http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/164044</a>



</pre>
<h3>Copyright</h3>
<pre>
    This document has been placed in the public domain.



</pre>
</div>
</body>
</html>
