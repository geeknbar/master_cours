<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/peps/pep-0001.html for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<head>
  <title>PEP 341 -- Unifying try-except and try-finally</title>
  <link rel="STYLESHEET" href="style.css" type="text/css" />
</head>
<body bgcolor="white">

<div class="header">
<table border="0">
  <tr><th>PEP:&nbsp;</th><td>341</td></tr>
  <tr><th>Title:&nbsp;</th><td>Unifying try-except and try-finally</td></tr>
  <tr><th>Version:&nbsp;</th><td>$Revision: 55060 $</td></tr>
  <tr><th>Last-Modified:&nbsp;</th><td><a href="http://svn.python.org/view/peps/trunk/pep-0341.txt">$Date: 2007-05-01 13:39:17 -0700 (Tue, 01 May 2007) $</a> </td></tr>
  <tr><th>Author:&nbsp;</th><td>Georg Brandl &lt;georg&#32;&#97;t&#32;python.org&gt;</td></tr>
  <tr><th>Status:&nbsp;</th><td>Final</td></tr>
  <tr><th>Type:&nbsp;</th><td>Standards Track</td></tr>
  <tr><th>Content-Type:&nbsp;</th><td><a href="pep-0009.html">text/plain</a> </td></tr>
  <tr><th>Created:&nbsp;</th><td>04-May-2005</td></tr>
  <tr><th>Post-History:&nbsp;</th><td></td></tr>
</table>
</div>
<hr />
<div class="content">
<h3>Abstract</h3>
<pre>
    This PEP proposes a change in the syntax and semantics of try
    statements to allow combined try-except-finally blocks. This
    means in short that it would be valid to write

        try:
            &lt;do something&gt;
        except Exception:
            &lt;handle the error&gt;
        finally:
            &lt;cleanup&gt;


</pre>
<h3>Rationale/Proposal</h3>
<pre>
    There are many use cases for the try-except statement and
    for the try-finally statement per se; however, often one needs
    to catch exceptions and execute some cleanup code afterwards.
    It is slightly annoying and not very intelligible that
    one has to write

        f = None
        try:
            try:
                f = open(filename)
                text = f.read()
            except IOError:
                print 'An error occurred'
        finally:
            if f:
                f.close()

    So it is proposed that a construction like this

        try:
            &lt;suite 1&gt;
        except Ex1:
            &lt;suite 2&gt;
        &lt;more except: clauses&gt;
        else:
            &lt;suite 3&gt;
        finally:
            &lt;suite 4&gt;

    be exactly the same as the legacy

        try:
            try:
                &lt;suite 1&gt;
            except Ex1:
                &lt;suite 2&gt;
            &lt;more except: clauses&gt;
            else:
                &lt;suite 3&gt;
        finally:
            &lt;suite 4&gt;

    This is backwards compatible, and every try statement that is
    legal today would continue to work.


</pre>
<h3>Changes to the grammar</h3>
<pre>
    The grammar for the try statement, which is currently

        try_stmt: ('try' ':' suite (except_clause ':' suite)+
                   ['else' ':' suite] | 'try' ':' suite 'finally' ':' suite)

    would have to become

        try_stmt: 'try' ':' suite
                  (
                    (except_clause ':' suite)+
                    ['else' ':' suite]
                    ['finally' ':' suite]
                  |
                    'finally' ':' suite
                  )

</pre>
<h3>Implementation</h3>
<pre>
    As the PEP author currently does not have sufficient knowledge
    of the CPython implementation, he is unfortunately not able
    to deliver one.  Thomas Lee has submitted a patch[2].

    However, according to Guido, it should be a piece of cake to
    implement[1] -- at least for a core hacker.

    This patch was committed 17 December 2005, SVN revision 41740 [3].


</pre>
<h3>References</h3>
<pre>
    [1] <a href="http://mail.python.org/pipermail/python-dev/2005-May/053319.html">http://mail.python.org/pipermail/python-dev/2005-May/053319.html</a>
    [2] <a href="http://python.org/sf/1355913">http://python.org/sf/1355913</a>
    [3] <a href="http://mail.python.org/pipermail/python-checkins/2005-December/048457.html">http://mail.python.org/pipermail/python-checkins/2005-December/048457.html</a>


</pre>
<h3>Copyright</h3>
<pre>
    This document has been placed in the public domain.


</pre>
</div>
</body>
</html>
