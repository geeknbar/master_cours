<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/peps/pep-0001.html for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<head>
  <title>PEP 259 -- Omit printing newline after newline</title>
  <link rel="STYLESHEET" href="style.css" type="text/css" />
</head>
<body bgcolor="white">

<div class="header">
<table border="0">
  <tr><th>PEP:&nbsp;</th><td>259</td></tr>
  <tr><th>Title:&nbsp;</th><td>Omit printing newline after newline</td></tr>
  <tr><th>Version:&nbsp;</th><td>$Revision: 56033 $</td></tr>
  <tr><th>Last-Modified:&nbsp;</th><td><a href="http://svn.python.org/view/peps/trunk/pep-0259.txt">$Date: 2007-06-18 21:20:07 -0700 (Mon, 18 Jun 2007) $</a> </td></tr>
  <tr><th>Author:&nbsp;</th><td>Guido van Rossum &lt;guido&#32;&#97;t&#32;python.org&gt;</td></tr>
  <tr><th>Status:&nbsp;</th><td>Rejected</td></tr>
  <tr><th>Type:&nbsp;</th><td>Standards Track</td></tr>
  <tr><th>Created:&nbsp;</th><td>11-Jun-2001</td></tr>
  <tr><th>Python-Version:&nbsp;</th><td>2.2</td></tr>
  <tr><th>Post-History:&nbsp;</th><td>11-Jun-2001</td></tr>
</table>
</div>
<hr />
<div class="content">
<h3>Abstract</h3>
<pre>
    Currently, the print statement always appends a newline, unless a
    trailing comma is used.  This means that if we want to print data
    that already ends in a newline, we get two newlines, unless
    special precautions are taken.

    I propose to skip printing the newline when it follows a newline
    that came from data.

    In order to avoid having to add yet another magic variable to file
    objects, I propose to give the existing 'softspace' variable an
    extra meaning: a negative value will mean "the last data written
    ended in a newline so no space *or* newline is required."


</pre>
<h3>Problem</h3>
<pre>
    When printing data that resembles the lines read from a file using
    a simple loop, double-spacing occurs unless special care is taken:

        &gt;&gt;&gt; for line in open("/etc/passwd").readlines():           
        ... print line 
        ... 
        root:x:0:0:root:/root:/bin/bash

        bin:x:1:1:bin:/bin:

        daemon:x:2:2:daemon:/sbin:

        (etc.)

        &gt;&gt;&gt;

    While there are easy work-arounds, this is often noticed only
    during testing and requires an extra edit-test roundtrip; the
    fixed code is uglier and harder to maintain.


</pre>
<h3>Proposed Solution</h3>
<pre>
    In the PRINT_ITEM opcode in ceval.c, when a string object is
    printed, a check is already made that looks at the last character
    of that string.  Currently, if that last character is a whitespace
    character other than space, the softspace flag is reset to zero;
    this suppresses the space between two items if the first item is a
    string ending in newline, tab, etc. (but not when it ends in a
    space).  Otherwise the softspace flag is set to one.

    The proposal changes this test slightly so that softspace is set
    to:

        -1 -- if the last object written is a string ending in a
              newline

         0 -- if the last object written is a string ending in a
              whitespace character that's neither space nor newline

         1 -- in all other cases (including the case when the last
              object written is an empty string or not a string)

    Then, the PRINT_NEWLINE opcode, printing of the newline is
    suppressed if the value of softspace is negative; in any case the
    softspace flag is reset to zero.


</pre>
<h3>Scope</h3>
<pre>
    This only affects printing of 8-bit strings.  It doesn't affect
    Unicode, although that could be considered a bug in the Unicode
    implementation.  It doesn't affect other objects whose string
    representation happens to end in a newline character.


</pre>
<h3>Risks</h3>
<pre>
    This change breaks some existing code.  For example:

        print "Subject: <a href="pep-0259.html">PEP 259</a>\n"
        print message_body

    In current Python, this produces a blank line separating the
    subject from the message body; with the proposed change, the body
    begins immediately below the subject.  This is not very robust
    code anyway; it is better written as

        print "Subject: <a href="pep-0259.html">PEP 259</a>"
        print
        print message_body

    In the test suite, only test_StringIO (which explicitly tests for
    this feature) breaks.


</pre>
<h3>Implementation</h3>
<pre>
    A patch relative to current CVS is here:

        <a href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=432183&amp;group_id=5470&amp;atid=305470">http://sourceforge.net/tracker/index.php?func=detail&amp;aid=432183&amp;group_id=5470&amp;atid=305470</a>


</pre>
<h3>Rejected</h3>
<pre>
    The user community unanimously rejected this, so I won't pursue
    this idea any further.  Frequently heard arguments against
    included:

    - It it likely to break thousands of CGI scripts.

    - Enough magic already (also: no more tinkering with 'print'
      please).


</pre>
<h3>Copyright</h3>
<pre>
    This document has been placed in the public domain.

</pre>
</div>
</body>
</html>
